<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>üéØ WinGo Predictor Pro ‚Äî Period Only (Meta-Ensemble)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  <style>
    :root{
      --gold:#FFD700; --gold-2:#f5d46b; --ink:#e5e7eb;
      --bg1:#0b0b0b; --bg2:#000; --card:#121212; --stroke:#1f2937;
      --ok:#22c55e; --warn:#f59e0b; --bad:#f87171;
      --goodBg:#0f1a12; --warnBg:#1b1506; --badBg:#1a0e10;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{ box-sizing:border-box }
    body{ margin:0; font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto;
          background:linear-gradient(140deg,var(--bg1),var(--bg2)); color:#fff; }
    header{ position:sticky; top:0; z-index:5; background:#000; border-bottom:1px solid #111;
            padding:12px 16px; box-shadow:0 2px 12px rgba(0,0,0,.35) }
    .brand{ max-width:1180px; margin:0 auto; display:flex; justify-content:space-between;
            align-items:center; gap:10px; font-weight:800; font-size:22px; color:var(--gold) }
    .container{ max-width:1180px; margin:0 auto; padding:20px 16px 40px }

    .card{ background:var(--card); border:1px solid rgba(255,255,255,.06); border-radius:var(--radius);
           padding:16px; box-shadow:var(--shadow); transition:background .25s,border-color .25s }
    .grid2{ display:grid; grid-template-columns:1.6fr 1fr; gap:14px }
    @media (max-width:900px){ .grid2{ grid-template-columns:1fr } }

    label{ font-size:14px; font-weight:700; color:#e7e7e7; display:block; margin-bottom:6px }
    input,select{ width:100%; padding:12px; border-radius:12px; border:2px solid #333; background:#0b0b0b;
                  color:#fff; font-size:16px; outline:none; transition:.2s border }
    input:focus,select:focus{ border-color:var(--gold) }
    .meta{ color:#9ca3af; font-size:13px; margin-top:6px }
    .actions{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; margin-top:12px }
    .btn{ background:linear-gradient(180deg,var(--gold),var(--gold-2)); color:#000; font-weight:800;
          border:0; padding:12px 16px; border-radius:12px; cursor:pointer;
          box-shadow:0 0 0 2px rgba(0,0,0,.2), 0 10px 18px rgba(255,215,0,.15) }
    .btn.secondary{ background:#1f2937; color:#e5e7eb; box-shadow:none; border:1px solid #2b3442 }

    .tag{ display:inline-block; padding:6px 10px; border:1px solid #2b3442; border-radius:999px; font-size:12px; color:#cbd5e1 }
    .pill{ display:inline-block; padding:6px 10px; border-radius:999px; border:1px solid #2b3442; margin-right:6px; font-weight:700 }
    .ok{ color:var(--ok) } .warn{ color:var(--warn) } .bad{ color:var(--bad) }

    .kv{ display:grid; grid-template-columns:repeat(3,1fr); gap:12px }
    @media (max-width:900px){ .kv{ grid-template-columns:1fr } }
    .kv .box{ background:#0a0a0a; border:1px solid #222; border-radius:14px; padding:16px }
    .key{ color:#9ca3af; font-size:13px }
    .val{ font-weight:900; font-size:32px; color:var(--gold) }

    .bigSmallRow{ margin-top:12px; display:grid; grid-template-columns:1.2fr 0.9fr 0.9fr; gap:12px }
    .statCard{ background:#0d0f12; border:1px solid #202a36; border-radius:12px; padding:12px }
    .valXL{ font-weight:900; font-size:22px; color:var(--gold) }
    .badge{ display:inline-block; padding:4px 8px; border-radius:8px; font-size:12px; background:#1a1a1a; border:1px solid #2a2a2a; margin-left:8px }
    .line{ height:10px; background:#1f2937; border-radius:999px; overflow:hidden; margin:8px 0 2px }
    .bar{ height:10px; width:0%; background:linear-gradient(90deg,var(--gold-2),var(--gold)) }

    .gridCharts{ display:grid; grid-template-columns:1fr 1fr; gap:14px; margin-top:14px }
    @media (max-width:900px){ .gridCharts{ grid-template-columns:1fr } }
    .history{ font-size:12px; color:#cbd5e1; max-height:200px; overflow:auto }
    .hrow{ padding:6px 0; border-bottom:1px dashed #222 }

    .theme-good{ background:var(--goodBg); border-color:#173021 }
    .theme-warn{ background:var(--warnBg); border-color:#3e2d08 }
    .theme-bad{  background:var(--badBg);  border-color:#3b1722 }

    /* compact */
    .compact #chartsWrap{ display:none }
    .compact #historyWrap{ display:none }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <span>üéØ WinGo Predictor Pro</span>
      <label style="display:flex;align-items:center;gap:8px;font-size:12px;color:#cbd5e1">
        <input type="checkbox" id="compactToggle"> Compact View
      </label>
    </div>
  </header>

  <div class="container" id="appRoot">
    <!-- CONTROL -->
    <div class="card">
      <div class="grid2">
        <div>
          <label for="period">üßæ Period Number (required)</label>
          <input id="period" placeholder="e.g. 20250813100052810" />
          <div class="meta">bdgop WinGo_30S ‡§ú‡•à‡§∏‡§æ ‡§≤‡§Æ‡•ç‡§¨‡§æ period ID ‚Äî ‡§ï‡•á‡§µ‡§≤ digits (0‚Äì9)</div>
        </div>
        <div>
          <label for="mode">Strategy</label>
          <select id="mode">
            <option value="balanced" selected>Normal</option>
            <option value="conservative">Confidence</option>
            <option value="aggressive">Very Confident</option>
          </select>
          <div class="meta" style="margin-top:10px;display:flex;gap:10px;align-items:center;flex-wrap:wrap">
            <span>
              <input id="autoNext" type="checkbox" style="transform:translateY(2px)"> Auto Next
              <input id="autoEvery" type="number" min="5" value="30" style="width:90px;margin-left:8px"> sec
            </span>
            <button class="btn secondary" id="notifyBtn">üîî Notifications</button>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn" id="btnPredict">üîÆ Predict</button>
        <button class="btn secondary" id="btnClear">Clear</button>
        <button class="btn secondary" id="btnCopy">Copy Result</button>
        <span class="tag" id="apiStatus">Engine: meta-ensemble</span>
      </div>
      <div class="meta" id="periodInfo">‚Äî</div>
    </div>

    <!-- RESULT -->
    <div class="card" id="resultCard" style="margin-top:16px;display:none">
      <div class="kv">
        <div class="box"><div class="key">üßæ Period</div><div class="val" id="vPeriod">‚Äî</div></div>
        <div class="box"><div class="key">üî¢ Number</div><div class="val" id="vNum">‚Äî</div></div>
        <div class="box"><div class="key">üìè Size</div><div class="val" id="vSize">‚Äî</div></div>
      </div>

      <div class="bigSmallRow">
        <div class="statCard">
          <div class="key">üß† Confidence <span class="badge" id="hiAcc" style="display:none">üî• High Accuracy Mode</span></div>
          <div class="line"><div class="bar" id="confBar"></div></div>
        </div>
        <div class="statCard"><div class="key">üü© Big</div><div class="valXL" id="vBig">‚Äî</div></div>
        <div class="statCard"><div class="key">üü• Small</div><div class="valXL" id="vSmall">‚Äî</div></div>
      </div>

      <div style="margin-top:12px">
        <span id="playSignal" class="pill">‚Äî</span>
        <span id="top2" class="pill">Safe set: ‚Äî</span>
        <span id="top3" class="pill">Top-3: ‚Äî</span>
        <span id="reasons" class="pill">‚Äî</span>
      </div>
    </div>

    <!-- CHARTS -->
    <div class="gridCharts" id="chartsWrap">
      <div class="card">
        <h3 style="margin:0 0 8px">üìä Probability (0‚Äì9)</h3>
        <canvas id="probChart" height="220"></canvas>
      </div>
      <div class="card">
        <h3 style="margin:0 0 8px">‚öñÔ∏è Big vs Small</h3>
        <canvas id="bsChart" height="220"></canvas>
      </div>
    </div>

    <!-- HISTORY -->
    <div class="card" style="margin-top:16px" id="historyWrap">
      <h3 style="margin:0 0 8px">üïò Recent Predictions</h3>
      <div id="hist" class="history">‚Äî</div>
    </div>
  </div>

  <script>
  (function(){
    // ---------- tiny utilities ----------
    const $ = id => document.getElementById(id);
    const root = $('appRoot');
    const isDigits = s => /^\d+$/.test(s||"");
    const clamp01 = x => Math.max(0, Math.min(1, x));
    const sum = a => a.reduce((p,c)=>p+c,0);
    const norm = a => { const s=sum(a)||1; return a.map(x=>x/s); };
    const argmax = a => { let i=0,b=-1; for(let k=0;k<a.length;k++) if(a[k]>b){b=a[k]; i=k;} return i; };
    const pct = x => (x*100).toFixed(1)+'%';

    // Robust Chart helpers (no crash if Chart.js fails to load)
    let probChart=null, bsChart=null;
    function safeChart(ctxId, cfg){
      try{
        if(!window.Chart) return null;
        const ctx = $(ctxId).getContext('2d');
        return new Chart(ctx, cfg);
      }catch(e){ console.warn('Chart error:', e); return null; }
    }

    function bumpPeriod(p){
      if(!isDigits(p)) return p;
      try { return (BigInt(p)+1n).toString(); }
      catch { const a=p.split('').map(d=>+d); for(let i=a.length-1;i>=0;i--){ if(a[i]===9)a[i]=0; else{a[i]++;break;} } return a.join(''); }
    }
    function describePeriod(p){ return isDigits(p) ? `len ${p.length} ‚Ä¢ tail ${p.slice(-4)}` : '‚Äî'; }

    // ---------- PRIOR FAMILY (6 signals) ----------
    function priorDigits(period){
      if(!isDigits(period)) return Array(10).fill(0.1);
      const d=period.split('').map(Number), s=d.reduce((a,b)=>a+b,0), last=d[d.length-1], last2=+(period.slice(-2));
      const mod10=s%10, mod7=s%7; const freq=Array(10).fill(0); d.forEach(x=>freq[x]++);
      const v=Array(10).fill(0.1);
      v[mod10]+=0.7; v[(last+10)%10]+=0.35; v[(last+1)%10]+=0.18; v[(last+9)%10]+=0.18;
      v[(mod7*3)%10]+=0.25; v[(mod7*5)%10]+=0.20;
      if(last2%2===0){ for(let i=0;i<10;i+=2) v[i]+=0.08; } else { for(let i=1;i<10;i+=2) v[i]+=0.08; }
      const mx=Math.max(...freq), mn=Math.min(...freq);
      for(let i=0;i<10;i++){ const rarity=(mx-mn)?(mx-freq[i])/(mx-mn):0; v[i]+=0.06*rarity; }
      return norm(v);
    }
    function priorParity(period){
      if(!isDigits(period)) return Array(10).fill(0.1);
      const last2=+(period.slice(-2)); const v=Array(10).fill(0.1);
      if(last2%2===0){ for(let i=0;i<10;i+=2) v[i]+=0.25; } else { for(let i=1;i<10;i+=2) v[i]+=0.25; }
      return norm(v);
    }
    function priorBucket(period){
      if(!isDigits(period)) return Array(10).fill(0.1);
      const tail=+(period.slice(-3)); const m=tail%10; const v=Array(10).fill(0.1);
      v[m]+=0.5; v[(m+3)%10]+=0.25; v[(m+7)%10]+=0.2; return norm(v);
    }
    function priorChecksum(period){
      if(!isDigits(period)) return Array(10).fill(0.1);
      const s=period.split('').reduce((a,b)=>a+(+b),0); const t=(s%9 + s%10)%10; const v=Array(10).fill(0.1);
      v[t]+=0.45; v[(t+1)%10]+=0.2; v[(t+9)%10]+=0.2; return norm(v);
    }
    function priorDistance(period){
      if(!isDigits(period)) return Array(10).fill(0.1);
      const last=+period.slice(-1); const v=Array(10).fill(0.1);
      for(let i=0;i<10;i++){ const d=Math.min((i-last+10)%10,(last-i+10)%10); v[i]+=0.35*Math.exp(-0.6*d); }
      return norm(v);
    }
    function priorHash(period){
      if(!isDigits(period)) return Array(10).fill(0.1);
      let h=0; for(let i=0;i<period.length;i++) h=(h*131 + period.charCodeAt(i))>>>0;
      const v=Array(10).fill(0.1);
      v[h%10]+=0.25; v[(h>>3)%10]+=0.15; v[(h>>7)%10]+=0.10; return norm(v);
    }

    // ---------- META-ENSEMBLE ----------
    function metaPredict(period, mode){
      const hyper = {
        conservative:{ temp:1.04, maxCap:0.58, jitter:0.05, adapt:0.12, w:[0.30,0.12,0.16,0.18,0.14,0.10] },
        balanced    :{ temp:1.06, maxCap:0.62, jitter:0.08, adapt:0.18, w:[0.28,0.14,0.18,0.18,0.12,0.10] },
        aggressive  :{ temp:1.08, maxCap:0.66, jitter:0.12, adapt:0.24, w:[0.26,0.16,0.20,0.18,0.10,0.10] },
      }[mode] || { temp:1.06, maxCap:0.62, jitter:0.08, adapt:0.18, w:[0.28,0.14,0.18,0.18,0.12,0.10] };

      const P = [
        priorDigits(period), priorParity(period), priorBucket(period),
        priorChecksum(period), priorDistance(period), priorHash(period)
      ];

      // Geometric-mean style blend in log space (robust)
      const logBlend = Array(10).fill(0);
      for(let i=0;i<10;i++){
        let s=0;
        for(let k=0;k<P.length;k++) s += (hyper.w[k]) * Math.log(P[k][i]+1e-12);
        logBlend[i]=Math.exp(s);
      }
      let base = norm(logBlend);

      // Adaptive push (third-peak pivot)
      const sorted = base.slice().sort((a,b)=>b-a);
      const t = (sorted[2]||0.1);
      base = norm(base.map(p => p * (1 + hyper.adapt*((p - t)/(t+1e-9)))));

      // Auto temperature: sharper if clear lead, flatter if flat
      const spread = sorted[0] - (sorted[1]||0);
      const autoT = clamp01(0.9 + 0.6*(0.15 - Math.min(0.15, spread))); // ~0.9..1.5
      const temp = Math.max(1.0, hyper.temp * autoT);

      // Bootstrap for stability + small jitter
      const B=64, j=hyper.jitter;
      let agg=Array(10).fill(0), votes=Array(10).fill(0);
      for(let b=0;b<B;b++){
        const p = norm(base.map(x => Math.max(0, x*(1 + (Math.random()*2-1)*j))));
        for(let i=0;i<10;i++) agg[i]+=p[i];
        votes[argmax(p)]++;
      }
      let probs = norm(agg);

      // Calibration curve (logit squeeze toward 0.5 then re-expand)
      probs = norm(probs.map(p=>{
        const z = Math.log((p+1e-9)/(1-p+1e-9));
        const z2 = 0.85*z; // shrink
        const q = 1/(1+Math.exp(-z2));
        return Math.pow(q, 1/temp);
      }));

      // Cap overconfidence
      const mx = Math.max(...probs);
      if(mx>hyper.maxCap){
        const iM = probs.indexOf(mx), excess = mx-hyper.maxCap; probs[iM]-=excess;
        const baseSum = probs.reduce((a,b,i)=>i===iM?a:a+b,0)||1;
        const scale = (1-probs[iM])/baseSum;
        for(let i=0;i<10;i++) if(i!==iM) probs[i]*=scale;
        probs = norm(probs);
      }
      const stability = Math.max(...votes)/B;
      return { probs, stability, spread };
    }

    // ---------- CHARTS ----------
    function renderCharts(probs){
      const big = probs.slice(5).reduce((a,b)=>a+b,0), small = 1-big;
      const labels=[...Array(10).keys()].map(String);
      const data=probs.map(p=>Math.round(p*1000)/10);

      if(probChart){ try{ probChart.destroy(); }catch(_){} }
      probChart = safeChart('probChart', {
        type:'bar',
        data:{labels, datasets:[{label:'Probability (%)', data}]},
        options:{responsive:true, scales:{ y:{beginAtZero:true,title:{display:true,text:'%'}}, x:{title:{display:true,text:'Digit'}}}}
      });

      if(bsChart){ try{ bsChart.destroy(); }catch(_){} }
      bsChart = safeChart('bsChart', {
        type:'doughnut',
        data:{labels:['Big','Small'], datasets:[{data:[Math.round(big*100), Math.round(small*100)]}]},
        options:{responsive:true, cutout:'60%'}
      });
      return {big, small};
    }

    // ---------- NOTIFY ----------
    function notify(title, body){
      try{
        if('Notification' in window && Notification.permission==='granted'){
          new Notification(title,{body});
        }
      }catch(_){}
    }

    // ---------- RENDER ----------
    function render(period, out){
      const probs = out.probs;
      const pick = argmax(probs);
      const {big, small} = renderCharts(probs);

      // score from entropy + stability
      let H=0; probs.forEach(p=>{ if(p>0) H += -p*Math.log(p); });
      const entropyConf = clamp01(1 - H/Math.log(10));
      const stability = clamp01(out.stability||0);
      const score = clamp01(0.55*entropyConf + 0.45*stability);

      // theme & signal
      const card = $('resultCard'); card.style.display='block';
      let signal='Play', cls='ok', theme='theme-good', issues=[];
      if(entropyConf<0.18) issues.push('low entropy');
      if(stability<0.28) issues.push('unstable');
      if(issues.length===1){ signal='Caution'; cls='warn'; theme='theme-warn'; }
      if(issues.length>=2){ signal='Wait'; cls='bad'; theme='theme-bad'; }
      card.classList.remove('theme-good','theme-warn','theme-bad'); card.classList.add(theme);

      // fill
      $('vPeriod').textContent=period;
      $('vNum').textContent=pick;
      $('vSize').textContent=pick>=5?'Big':'Small';
      $('vBig').textContent=pct(big);
      $('vSmall').textContent=pct(small);
      $('confBar').style.width=(score*100).toFixed(1)+'%';
      $('hiAcc').style.display = score>=0.85 ? 'inline-block' : 'none';

      const sorted = probs.map((p,i)=>({i,p})).sort((a,b)=>b.p-a.p);
      $('top2').textContent='Safe set: '+sorted.slice(0,2).map(o=>o.i).join(', ');
      $('top3').textContent='Top-3: '+sorted.slice(0,3).map(o=>`${o.i} (${(o.p*100).toFixed(1)}%)`).join(', ');
      $('playSignal').textContent=signal; $('playSignal').className='pill '+cls;
      $('reasons').textContent = issues.length? ('Reasons: '+issues.join(', ')) : `Score: ${(score*100).toFixed(0)}%`;

      // history (max 10)
      const h=$('hist'); if(h.textContent==='‚Äî') h.textContent='';
      const stamp=new Date().toLocaleTimeString();
      h.insertAdjacentHTML('afterbegin', `<div class="hrow">‚è± ${stamp} ‚Ä¢ Period ${period} ‚Üí #${pick} (${pick>=5?'Big':'Small'}) ‚Ä¢ score ${(score*100).toFixed(0)}%</div>`);
      [...h.children].slice(10).forEach(n=>n.remove());

      if(signal==='Play') notify('WinGo: Play', `Period ${period} ‚Üí ${pick} (${pick>=5?'Big':'Small'})`);
    }

    // ---------- CONTROLLER ----------
    let autoTimer=null;
    function runPredict(){
      try{
        const pr = $('period').value.trim();
        if(!pr || !isDigits(pr)){ alert('Valid period number ‡§≠‡§∞‡•á‡§Ç (digits only)'); return; }
        $('periodInfo').textContent='Period: '+describePeriod(pr);
        const out = metaPredict(pr, $('mode').value);
        render(pr, out);
      }catch(err){
        console.error(err);
        alert('Prediction error: '+(err?.message||err));
      }
    }
    function startAuto(){
      clearInterval(autoTimer); autoTimer=null;
      const sec = Math.max(5, parseInt($('autoEvery').value||'30',10));
      autoTimer = setInterval(()=>{
        const cur = $('period').value.trim();
        if(isDigits(cur)) $('period').value = bumpPeriod(cur);
        runPredict();
      }, sec*1000);
    }

    // ---------- EVENTS (robust) ----------
    $('btnPredict').addEventListener('click', runPredict);
    $('period').addEventListener('keydown', e=>{ if(e.key==='Enter') runPredict(); });
    $('btnClear').addEventListener('click', ()=>{
      clearInterval(autoTimer); autoTimer=null; $('autoNext').checked=false;
      $('period').value=''; $('periodInfo').textContent='‚Äî'; $('resultCard').style.display='none';
      $('hist').textContent='‚Äî';
      try{ probChart&&probChart.destroy(); bsChart&&bsChart.destroy(); }catch(_){}
      probChart=bsChart=null;
    });
    $('btnCopy').addEventListener('click', async ()=>{
      const n=$('vNum').textContent; if(!n||n==='‚Äî'){ alert('‡§™‡§π‡§≤‡•á Predict ‡§ï‡§∞‡•á‡§Ç'); return; }
      const txt=`Period: ${$('vPeriod').textContent}, Number: ${$('vNum').textContent}, Size: ${$('vSize').textContent}, Big:${$('vBig').textContent}, Small:${$('vSmall').textContent}`;
      try{ await navigator.clipboard.writeText(txt); alert('Copied!'); }catch{ alert('Copy failed'); }
    });
    $('autoNext').addEventListener('change', e=>{ clearInterval(autoTimer); autoTimer=null; if(e.target.checked) startAuto(); });
    $('notifyBtn').addEventListener('click', async ()=>{
      if(!('Notification' in window)) return alert('Notifications not supported');
      if(Notification.permission==='granted') return alert('Notifications enabled');
      try{ await Notification.requestPermission(); alert('Done'); }catch(_){}
    });
    $('compactToggle').addEventListener('change', e=>{ if(e.target.checked) root.classList.add('compact'); else root.classList.remove('compact'); });

    // deep-link support: ?period=...&mode=...
    const q=new URLSearchParams(location.search);
    if(q.get('period')) $('period').value=q.get('period');
    if(q.get('mode')) $('mode').value=q.get('mode');
    if($
