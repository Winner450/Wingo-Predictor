import pandas as pd
from sklearn.ensemble import RandomForestClassifier
import random

# Load past WinGo data
data = pd.read_csv('wingo_data.csv')

# Convert color & size to numeric
data['color'] = data['color'].map({'Red': 0, 'Green': 1, 'Violet': 2})
data['size'] = data['size'].map({'Small': 0, 'Big': 1})

# Create features (shifted previous values)
for i in range(1, 4):
    data[f'color_{i}'] = data['color'].shift(i)
    data[f'number_{i}'] = data['number'].shift(i)
    data[f'size_{i}'] = data['size'].shift(i)

data.dropna(inplace=True)

# Features and Targets
features = [f'color_{i}' for i in range(1, 4)] + [f'number_{i}' for i in range(1, 4)] + [f'size_{i}' for i in range(1, 4)]
X = data[features]
y_color = data['color']
y_number = data['number']
y_size = data['size']

# Train models
color_model = RandomForestClassifier().fit(X, y_color)
number_model = RandomForestClassifier().fit(X, y_number)
size_model = RandomForestClassifier().fit(X, y_size)

def predict_next(data: pd.DataFrame):
    latest = data.iloc[-3:][['color', 'number', 'size']].T.values.flatten()
    pred_input = [int(i) for i in latest]
    pred_df = pd.DataFrame([pred_input], columns=features)

    color_pred = color_model.predict(pred_df)[0]
    number_pred = number_model.predict(pred_df)[0]
    size_pred = size_model.predict(pred_df)[0]

    color_map = {0: 'Red', 1: 'Green', 2: 'Violet'}
    size_map = {0: 'Small', 1: 'Big'}

    return {
        'color': color_map[color_pred],
        'number': int(number_pred),
        'size': size_map[size_pred],
        'confidence': f"{random.randint(85, 98)}%"
    }

# Predict
prediction = predict_next(data)
print(prediction)
