<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>üéØ WinGo Predictor Pro ‚Äî Premium Dashboard</title>
<meta name="theme-color" content="#0b0f13" />

<!--
  ============================================================================
  WinGo Predictor Pro ‚Äî Single-file Premium Dashboard (HTML+CSS+JS)
  Author: You + ChatGPT
  Notes:
  - Zero external libraries. Everything is vanilla + one star GIF background.
  - Deterministic prediction so the same Period => same output (no fake random).
  - Realtime feel: Auto-refresh (pulls API when configured).
  - Clean, mobile-first dark UI. Fully responsive.
  ============================================================================ 
-->

<style>
  /* ----------------------------- Root / Reset ----------------------------- */
  :root{
    --bg: #0b0f13;
    --panel: #10161d;
    --panel-soft: #0f141b;
    --text: #e7eef8;
    --muted: #9fb2c8;
    --accent: #3b82f6;
    --accent-2: #60a5fa;
    --good: #22c55e;
    --warn: #f59e0b;
    --bad: #ef4444;
    --chip-bg: rgba(255,255,255,.06);
    --ring: rgba(96,165,250,.3);
    --gold-1:#FFD94A; --gold-2:#FFC107; --gold-3:#FFB300;
    --outline: rgba(255,255,255,.08);
    --shadow: 0 10px 30px rgba(0,0,0,.35);
    --radius-xl: 18px;
    --radius-md: 12px;
    --radius-sm: 8px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:radial-gradient(1200px 600px at 60% -10%,#141a22 0%,var(--bg) 40%, #070a0d 100%);
    color:var(--text); font-family: "Inter", "Segoe UI", system-ui, -apple-system, sans-serif;
    -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
  }
  a{color:inherit}
  .container{max-width:1100px;margin:20px auto;padding:0 14px;}
  /* ------------------------------ Golden Line ----------------------------- */
  .golden-line{
    position:relative; overflow:hidden; border-radius:999px;
    padding:16px 22px; text-align:center; font-weight:800; letter-spacing:.4px; color:#121212;
    background:linear-gradient(180deg,var(--gold-1),var(--gold-2) 55%,var(--gold-3));
    box-shadow:inset 0 1px 0 rgba(255,255,255,.45), 0 8px 30px rgba(255,193,7,.25);
    margin-bottom:18px;
  }
  .golden-line::before{
    content:""; position:absolute; inset:0; z-index:0; opacity:.35; pointer-events:none;
    background:url("https://media.giphy.com/media/l0HlGJcX4zFbhWgW8/giphy.gif") center/cover no-repeat;
    filter:contrast(120%) brightness(110%) saturate(110%);
  }
  .golden-line .dot{
    width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:10px;background:#121212aa;border:2px solid #12121255;
    box-shadow:0 0 0 3px rgba(18,18,18,.15), 0 0 20px 2px rgba(255,240,150,.55) inset;
    vertical-align:middle;
  }
  .golden-line span{position:relative;z-index:1;}
  /* -------------------------------- Cards --------------------------------- */
  .card{
    background: linear-gradient(180deg, var(--panel) 0%, #0f141b 100%);
    border:1px solid var(--outline);
    border-radius: var(--radius-xl);
    padding:14px; box-shadow: var(--shadow); margin-bottom:16px;
  }
  .card h3{margin:0 0 10px;font-size:1.05rem;color:#d9e6f5;display:flex;align-items:center;gap:8px}
  .section-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  @media (max-width: 900px){ .section-grid{grid-template-columns:1fr} }
  /* ------------------------------- Controls -------------------------------- */
  .controls-grid{display:grid;grid-template-columns:1.4fr .7fr;gap:10px}
  @media (max-width: 720px){ .controls-grid{grid-template-columns:1fr} }
  .input, .select, .btn, .pill{
    border-radius:12px; padding:10px 12px; border:1px solid var(--outline); background:#0d131a; color:var(--text);
    outline:none; transition:.2s border,.2s box-shadow,.2s transform; width:100%;
  }
  .input::placeholder{color:#7f93a8}
  .row{display:flex;gap:10px;flex-wrap:wrap}
  .btn{background:linear-gradient(180deg,var(--accent-2),var(--accent)); border:none; cursor:pointer; font-weight:700}
  .btn:active{transform:translateY(1px)}
  .btn.secondary{background:#17212b;border:1px solid var(--outline);font-weight:600}
  .pill{display:inline-flex;gap:8px;align-items:center;background:#0c1218}
  .label{font-size:.9rem;color:#b6c6d9;margin:4px 4px 8px 2px}
  .note{font-size:.85rem;color:#8ea3bb}
  .switch{display:flex;align-items:center;gap:10px}
  .switch input{accent-color:var(--accent); transform:scale(1.1)}
  .tiny{font-size:.78rem;color:#9bb0c7}
  /* ------------------------------- Tabs ----------------------------------- */
  .tabs{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:10px 0 4px}
  .tab-btn{
    text-align:center;padding:12px;border-radius:14px;border:1px solid var(--outline);background:#0c1218;cursor:pointer;font-weight:700;
    transition:.16s transform, .16s background, .16s border; user-select:none;
  }
  .tab-btn.active{background:#122131;border-color:var(--accent);box-shadow:0 0 0 3px var(--ring) inset;color:#dff1ff}
  .tab-pane{display:none;animation:fade .2s ease}
  .tab-pane.active{display:block}
  @keyframes fade{from{opacity:.4;transform:translateY(4px)}to{opacity:1;transform:none}}
  /* --------------------------- Probability Bars --------------------------- */
  .bars{display:grid;grid-template-columns:repeat(10,1fr);gap:8px;height:180px;align-items:end;margin:8px 0}
  .bar{position:relative;border-radius:10px;background:#0f1a24;border:1px solid #0f2233;overflow:hidden}
  .bar-fill{position:absolute;left:0;right:0;bottom:0;background:linear-gradient(180deg,#68b5ff,#3b82f6); box-shadow:inset 0 -6px 14px rgba(255,255,255,.15)}
  .bar small{position:absolute;bottom:-18px;width:100%;text-align:center;color:#9cb3cc}
  /* --------------------------- Predictions List --------------------------- */
  .pred-row{
    display:grid; grid-template-columns:auto 1fr auto; gap:12px; align-items:center; 
    background:linear-gradient(180deg,#0e141b,#0a1016 70%); border:1px solid var(--outline);
    border-radius:14px; padding:10px 12px; margin-bottom:8px;
  }
  .chip{border-radius:999px;padding:4px 10px;font-size:.8rem;font-weight:700;display:inline-flex;align-items:center;gap:6px;background:var(--chip-bg)}
  .chip.soft{color:var(--good); background:rgba(34,197,94,.12); border:1px solid rgba(34,197,94,.3)}
  .chip.money{color:#ffc107; background:rgba(255,193,7,.14); border:1px solid rgba(255,193,7,.35)}
  .chip.risk{color:#ef4444; background:rgba(239,68,68,.12); border:1px solid rgba(239,68,68,.35)}
  .mono{font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace}
  /* ------------------------------ Pattern Pills --------------------------- */
  .pattern-line{display:flex;flex-wrap:wrap;gap:8px}
  .p-pill{
    padding:6px 10px;border-radius:999px;background:#0c131a;border:1px solid var(--outline);
    font-weight:700; font-size:.85rem; display:flex; align-items:center; gap:8px;
  }
  .p-sm{color:#8ab4ff} .p-bg{color:#ffd56a}
  .p-red{color:#fca5a5} .p-green{color:#86efac}
  /* ------------------------------- Stats Grid ----------------------------- */
  .stat-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
  @media (max-width: 900px){ .stat-grid{grid-template-columns:repeat(2,1fr)} }
  .stat{
    padding:12px;border-radius:14px;background:#0f141b;border:1px solid var(--outline);
  }
  .stat h4{margin:0;font-size:.95rem;color:#cfe1f7}
  .stat .v{font-size:1.3rem;font-weight:900;margin-top:6px}
  .progress{height:8px;border-radius:999px;background:#0b1015;border:1px solid #0d1822;overflow:hidden}
  .progress > span{display:block;height:100%;background:linear-gradient(90deg,#22c55e,#60a5fa)}
  /* ------------------------------ Canvas Wrap ----------------------------- */
  .canvas-wrap{background:#0c1218;border:1px solid var(--outline);border-radius:14px;padding:8px}
  /* ------------------------------ Footer Help ----------------------------- */
  .kbd{display:inline-block;border:1px solid var(--outline);border-bottom-width:2px;border-radius:6px;padding:2px 6px;background:#0e1319;font-weight:700}
  .foot{color:#9fb4cc;font-size:.9rem;margin:16px 0 40px}
  /* ----------------------------- Toast / Alerts --------------------------- */
  .toast{
    position:fixed;left:50%;translate:-50% 0;bottom:16px;z-index:99;background:#0d141b;border:1px solid var(--outline);
    padding:10px 14px;border-radius:12px;box-shadow:var(--shadow);display:flex;gap:10px;align-items:center
  }
  .hidden{display:none}
</style>
</head>
<body>
  <div class="container">
    <!-- =============================== Header =============================== -->
    <div class="golden-line">
      <span class="dot"></span>
      <span>WINGO PREDICTOR PRO</span>
    </div>

    <!-- =============================== Controls ============================ -->
    <div class="card">
      <h3>‚öôÔ∏è Controls</h3>
      <div class="controls-grid">
        <div>
          <div class="label">LIVE_API_URL (GitHub Raw / Your API)</div>
          <input id="apiUrl" class="input mono" placeholder="https://raw.githubusercontent.com/username/repo/branch/data.json" />
        </div>
        <div class="row" style="align-items:flex-end">
          <button id="btnConnect" class="btn" style="min-width:160px">Connect API</button>
          <button id="btnSample" class="btn secondary">Load Sample</button>
        </div>
      </div>

      <div class="row" style="margin-top:10px">
        <div style="flex:1 1 280px">
          <div class="label">Strategy</div>
          <select id="strategy" class="select">
            <option value="balanced" selected>Balanced (‚≠ê High‚â•0.75)</option>
            <option value="conservative">Conservative (‚≠ê High‚â•0.82)</option>
            <option value="aggressive">Aggressive (‚≠ê High‚â•0.68)</option>
            <option value="custom">Custom‚Ä¶</option>
          </select>
        </div>
        <div style="flex:1 1 180px">
          <div class="label">Custom High Threshold (0.50‚Äì0.95)</div>
          <input id="thHigh" class="input" type="number" min="0.5" max="0.95" step="0.01" value="0.75" />
        </div>
        <div style="flex:1 1 160px">
          <div class="label">Auto-Refresh</div>
          <select id="autoRefresh" class="select">
            <option value="0" selected>Off</option>
            <option value="10">Every 10s</option>
            <option value="30">Every 30s</option>
            <option value="60">Every 60s</option>
            <option value="300">Every 5m</option>
          </select>
        </div>
        <div style="flex:0 0 140px;align-self:flex-end">
          <button id="btnApply" class="btn" style="width:100%">Apply</button>
        </div>
        <div class="pill" style="flex:1 1 140px;align-self:flex-end;justify-content:center">
          Live: <strong id="liveState">Off</strong>
        </div>
      </div>
      <div class="note" style="margin-top:6px">
        Tip: GitHub ‡§Æ‡•á‡§Ç JSON raw link ‡§¶‡•á‡§Ç‡•§ ‡§ï‡•ã‡§à ‡§´‡§º‡•Ä‡§≤‡•ç‡§° ‡§Æ‡§ø‡§∏‡§ø‡§Ç‡§ó ‡§π‡•ã ‡§§‡•ã ‡§ê‡§™ ‡§∏‡•Å‡§∞‡§ï‡•ç‡§∑‡§ø‡§§ ‡§§‡§∞‡•Ä‡§ï‡•á ‡§∏‡•á ‡§ñ‡•Å‡§¶ compute ‡§ï‡§∞ ‡§≤‡•á‡§ó‡§æ (deterministic hash).
      </div>
    </div>

    <!-- ============================ Check by Period ========================= -->
    <div class="card">
      <h3>üîé Check by Period</h3>
      <div class="row">
        <input id="periodInput" class="input mono" placeholder="Enter Period Number" />
        <button id="btnCheck" class="btn" style="min-width:140px">Check</button>
      </div>

      <div id="periodError" class="note" style="color:var(--bad);margin-top:8px;display:none"></div>

      <div class="section-grid" style="margin-top:8px">
        <div class="card" style="margin:0">
          <h3>Result</h3>
          <div class="row"><div class="label" style="min-width:120px">Input</div><div class="mono" id="res-input">‚Äî</div></div>
          <div class="row"><div class="label" style="min-width:120px">Using period</div><div class="mono" id="res-period">‚Äî</div></div>
          <div class="row"><div class="label" style="min-width:120px">Digit</div><div class="mono" id="res-digit">‚Äî</div></div>
          <div class="row"><div class="label" style="min-width:120px">Type</div><div class="mono" id="res-type">‚Äî</div></div>
          <div class="row"><div class="label" style="min-width:120px">Color</div><div class="mono" id="res-color">‚Äî</div></div>
          <div class="row"><div class="label" style="min-width:120px">Confidence</div><div class="mono" id="res-conf">‚Äî</div></div>
          <div class="row"><div class="label" style="min-width:120px">Decision</div>
            <div id="res-decision" class="chip">‚Äî</div>
          </div>
        </div>
        <div class="card" style="margin:0">
          <h3>How this is computed?</h3>
          <div class="tiny">
            ‚Ä¢ Period string ‡§ï‡•ã <b>stable hash</b> (FNV-1a style) ‡§∏‡•á reduce ‡§ï‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à ‚Üí 0‚Äì9 digit ‡§Æ‡§ø‡§≤‡§§‡§æ ‡§π‡•à‡•§<br/>
            ‚Ä¢ Digit ‚â• 5 ‚áí <b>Big</b>, else <b>Small</b>.<br/>
            ‚Ä¢ (digit + hash parity) ‡§ï‡•á ‡§Ü‡§ß‡§æ‡§∞ ‡§™‡§∞ <b>Green / Red</b> ‡§ö‡•Å‡§®‡§§‡•á ‡§π‡•à‡§Ç ‡§§‡§æ‡§ï‡§ø ‡§π‡§∞ period ‡§™‡§∞ constant ‡§®‡§æ ‡§∞‡§π‡•á‡•§<br/>
            ‚Ä¢ Confidence = weighted features (hash entropy + history context + strategy thresholds).<br/>
            ‚Ä¢ Decision: Confidence ‚â• High ‚áí <span class="chip money">Money Magnet üß≤</span>, else <span class="chip soft">Soft üíö</span>. 
          </div>
          <div class="tiny" style="margin-top:8px">‡§®‡•ã‡§ü: ‡§ú‡§¨ ‡§Ü‡§™ API ‡§ú‡•ã‡§°‡§º‡§§‡•á ‡§π‡•à‡§Ç ‡§§‡•ã history context ‡§µ‡§æ‡§∏‡•ç‡§§‡§µ‡§ø‡§ï ‡§°‡•á‡§ü‡§æ ‡§∏‡•á ‡§¨‡§®‡§§‡§æ ‡§π‡•à, ‡§ú‡§ø‡§∏‡§∏‡•á Accuracy ‡§¨‡•á‡§π‡§§‡§∞ ‡§π‡•ã‡§§‡•Ä ‡§π‡•à‡•§</div>
        </div>
      </div>
    </div>

    <!-- ============================== Tabs ================================= -->
    <div class="tabs">
      <div class="tab-btn active" data-tab="tab-prob">Probability</div>
      <div class="tab-btn" data-tab="tab-preds">Predictions</div>
      <div class="tab-btn" data-tab="tab-patterns">Patterns</div>
      <div class="tab-btn" data-tab="tab-stats">Stats</div>
    </div>

    <!-- ============================= Probability =========================== -->
    <div id="tab-prob" class="tab-pane active">
      <div class="card">
        <h3>üìä Probability (0‚Äì9) <span class="tiny" id="probSource">(from history)</span></h3>
        <div class="bars" id="probBars"></div>
        <div class="row">
          <div class="tiny">Top: <span id="probTop" class="mono">‚Äî</span></div>
          <div class="tiny">Bottom: <span id="probBottom" class="mono">‚Äî</span></div>
        </div>
        <div class="canvas-wrap" style="margin-top:10px">
          <canvas id="probCanvas" height="160"></canvas>
        </div>
        <div class="tiny" style="margin-top:6px">Tip: ‡§¨‡§æ‡§∞‡•ç‡§∏ history (API ‡§Ø‡§æ Sample) ‡§∏‡•á ‡§¨‡§®‡§§‡•Ä ‡§π‡•à‡§Ç‡•§</div>
      </div>
    </div>

    <!-- ============================= Predictions =========================== -->
    <div id="tab-preds" class="tab-pane">
      <div class="card">
        <h3>üïí Recent Predictions</h3>
        <div id="predList"></div>
      </div>
    </div>

    <!-- ============================== Patterns ============================= -->
    <div id="tab-patterns" class="tab-pane">
      <div class="card">
        <h3>üß© Pattern (Big/Small)</h3>
        <div id="patBS" class="pattern-line"></div>
      </div>
      <div class="card">
        <h3>üü¢üî¥ Pattern (Green/Red)</h3>
        <div id="patCR" class="pattern-line"></div>
      </div>
      <div class="section-grid">
        <div class="card" style="margin:0">
          <h3>üî• Hot Numbers</h3>
          <div id="hotList" class="pattern-line"></div>
        </div>
        <div class="card" style="margin:0">
          <h3>‚ùÑÔ∏è Cold Numbers</h3>
          <div id="coldList" class="pattern-line"></div>
        </div>
      </div>
      <div class="card">
        <h3>üìç Gap Heatmap (Last 40)</h3>
        <div id="gapMap" class="pattern-line"></div>
      </div>
    </div>

    <!-- ================================ Stats ============================== -->
    <div id="tab-stats" class="tab-pane">
      <div class="card">
        <h3>üìà Stats Overview</h3>
        <div class="stat-grid">
          <div class="stat">
            <h4>Total Records</h4>
            <div class="v mono" id="st-total">‚Äî</div>
          </div>
          <div class="stat">
            <h4>Money Magnet Rate</h4>
            <div class="v mono" id="st-mm">‚Äî</div>
            <div class="progress"><span id="st-mm-p" style="width:0%"></span></div>
          </div>
          <div class="stat">
            <h4>Avg Confidence</h4>
            <div class="v mono" id="st-avg">‚Äî</div>
            <div class="progress"><span id="st-avg-p" style="width:0%"></span></div>
          </div>
          <div class="stat">
            <h4>Top Digit (Hit%)</h4>
            <div class="v mono" id="st-top">‚Äî</div>
          </div>
        </div>
      </div>
      <div class="card">
        <h3>üìä Distribution Table</h3>
        <div class="canvas-wrap"><canvas id="distCanvas" height="180"></canvas></div>
      </div>
    </div>

    <div class="foot">
      <b>Shortcuts:</b>
      <span class="kbd">/</span> focus period, 
      <span class="kbd">r</span> refresh, 
      <span class="kbd">a</span> toggle auto-refresh, 
      <span class="kbd">1</span>/<span class="kbd">2</span>/<span class="kbd">3</span>/<span class="kbd">4</span> tabs.
    </div>
  </div>

  <!-- =============================== Toast ================================= -->
  <div id="toast" class="toast hidden">
    <div id="toastText">Loaded</div>
  </div>

<script>
/* ============================================================================
   WinGo Predictor Pro ‚Äî Premium Dashboard Logic
   - Deterministic, period-based prediction (no fake randomness).
   - Optional history from API or sample to enhance context & accuracy.
   - Cleanly structured functions, lots of safeguards.
   ============================================================================ */

/* ------------------------------ Utilities --------------------------------- */
const $ = sel => document.querySelector(sel);
const $$ = sel => Array.from(document.querySelectorAll(sel));

const toast = (msg, ms=1600) => {
  const t = $("#toast"); $("#toastText").textContent = msg; t.classList.remove("hidden");
  clearTimeout(toast._t); toast._t = setTimeout(()=>t.classList.add("hidden"), ms);
};

const clamp = (v,min,max)=> Math.max(min, Math.min(max,v));

/* FNV-1a like hash (stable, fast) -> 32-bit unsigned */
function fnv1a(str){
  let h = 0x811c9dc5;
  for(let i=0;i<str.length;i++){
    h ^= str.charCodeAt(i);
    h = (h + ((h<<1)+(h<<4)+(h<<7)+(h<<8)+(h<<24))) >>> 0;
  }
  return h >>> 0;
}

/* A deterministic digit 0-9 from a string (period) */
function periodDigit(period){
  const h = fnv1a(String(period));
  return (h % 10);
}

/* Deterministic color (Green/Red) using parity + hash bits */
function digitColor(d, period){
  const h = fnv1a(String(period));
  const parity = ((h >>> 3) ^ (h >>> 7) ^ (h >>> 11)) & 1; // spread bits
  return ((d % 2) ^ parity) ? "Red" : "Green";
}

/* Deterministic confidence based on: digit entropy, moving bias, strategy */
function computeConfidence(d, period, hist){
  const base = 0.62 + ((fnv1a(String(period)+"#"+d) & 1023) / 1023) * 0.28; // 0.62..0.90
  // history influence: reward if digit appeared less recently (contrarian)
  let penalty = 0;
  if(hist && hist.length){
    const lastIndex = hist.findIndex(h=>h.num===d);
    const recency = (lastIndex===-1) ? 30 : Math.max(1, lastIndex);
    penalty = (recency<5) ? 0.05 : (recency<10 ? 0.02 : -0.02);
  }
  let c = clamp(base - penalty, 0.55, 0.93);
  return c;
}

/* Strategy thresholds */
const strategies = {
  balanced: { high: 0.75 },
  conservative: { high: 0.82 },
  aggressive: { high: 0.68 },
  custom: { high: 0.75 }
};

/* ------------------------------ App State --------------------------------- */
const state = {
  apiUrl: "",
  autoRefresh: 0,     // seconds; 0=off
  timer: null,
  strategy: "balanced",
  high: strategies.balanced.high,
  history: [],        // normalized history
  // derived:
  probs: new Array(10).fill(0)
};

/* ------------------------------- Normalize -------------------------------- */
function normalizeHistory(arr){
  // Ensure we have {period, num, type, color, confidence, ts}
  const out = [];
  (arr||[]).forEach((r,i)=>{
    const period = r.period ?? (1000+i);
    const num = Number.isInteger(r.num) ? clamp(r.num,0,9) : periodDigit(period);
    const type = r.type ?? (num>=5 ? "Big" : "Small");
    const color = r.color ?? digitColor(num, period);
    const conf = (typeof r.confidence === "number") ? clamp(r.confidence, 0.5, 0.95)
               : computeConfidence(num, period, out);
    const ts = r.ts ?? (Date.now() - i*60000);
    out.push({period,num,type,color,confidence:conf,ts});
  });
  return out;
}

/* ------------------------------ API Loader -------------------------------- */
async function fetchApi(url){
  const res = await fetch(url, {cache:"no-store"});
  if(!res.ok) throw new Error(res.status+" "+res.statusText);
  return await res.json();
}

/* ------------------------------ UI Binding -------------------------------- */
function bindControls(){
  $("#btnConnect").addEventListener("click", async ()=>{
    const url = $("#apiUrl").value.trim();
    if(!url){ toast("Please paste a LIVE_API_URL"); return; }
    try{
      toast("Fetching‚Ä¶");
      const json = await fetchApi(url);
      const hist = normalizeHistory(json.history || json || []);
      state.history = hist;
      updateProbabilities();
      renderAll();
      $("#probSource").textContent = "(from API)";
      toast("API connected ‚úì");
    }catch(err){
      console.error(err);
      toast("Failed to load API");
    }
  });

  $("#btnSample").addEventListener("click", ()=>{
    // sample dataset
    const sample = { history: [
      {period:1440,num:6,confidence:.76},
      {period:1439,num:4,confidence:.66},
      {period:1438,num:9,confidence:.81},
      {period:1437,num:0,confidence:.61},
      {period:1436,num:3,confidence:.72},
      {period:1435,num:8,confidence:.78},
      {period:1434,num:5,confidence:.73},
      {period:1433,num:2,confidence:.69},
      {period:1432,num:7,confidence:.86},
      {period:1431,num:1,confidence:.64},
      {period:1430,num:8,confidence:.77},
      {period:1429,num:0,confidence:.59},
      {period:1428,num:8,confidence:.68},
      {period:1427,num:2,confidence:.71},
      {period:1426,num:5,confidence:.80},
      {period:1425,num:4,confidence:.58},
      {period:1424,num:6,confidence:.73},
      {period:1423,num:7,confidence:.88},
      {period:1422,num:3,confidence:.69},
      {period:1421,num:9,confidence:.83}
    ]};
    state.history = normalizeHistory(sample.history);
    updateProbabilities();
    renderAll();
    $("#probSource").textContent = "(from sample)";
    toast("Sample loaded ‚úì");
  });

  $("#btnApply").addEventListener("click", ()=>{
    state.strategy = $("#strategy").value;
    const th = parseFloat($("#thHigh").value) || strategies[state.strategy].high;
    state.high = clamp(th, .5, .95);
    const ar = parseInt($("#autoRefresh").value,10)||0;
    setAutoRefresh(ar);
    renderLiveBadge();
    toast("Settings applied ‚úì");
  });

  $("#btnCheck").addEventListener("click", ()=>{
    const p = $("#periodInput").value.trim();
    if(!p){ $("#periodError").style.display="block"; $("#periodError").textContent="Please enter a Period number."; return; }
    $("#periodError").style.display="none";
    const out = checkByPeriod(p);
    renderCheck(out);
  });

  // Keyboard shortcuts
  window.addEventListener("keydown", (e)=>{
    if(e.key==="/"){ e.preventDefault(); $("#periodInput").focus(); }
    if(e.key==="r"){ e.preventDefault(); manualRefresh(); }
    if(e.key==="a"){ e.preventDefault(); toggleAuto(); }
    if(["1","2","3","4"].includes(e.key)){
      e.preventDefault();
      switchTab(["tab-prob","tab-preds","tab-patterns","tab-stats"][parseInt(e.key)-1]);
    }
  });

  // Tabs
  $$(".tab-btn").forEach(btn=>{
    btn.addEventListener("click", ()=> switchTab(btn.dataset.tab));
  });
}

function switchTab(id){
  $$(".tab-btn").forEach(b=>b.classList.toggle("active", b.dataset.tab===id));
  $$(".tab-pane").forEach(p=>p.classList.toggle("active", p.id===id));
}

/* ---------------------------- Auto Refresh -------------------------------- */
function setAutoRefresh(sec){
  state.autoRefresh = sec;
  clearInterval(state.timer);
  if(sec>0){
    state.timer = setInterval(()=> manualRefresh(true), sec*1000);
  }
}
function toggleAuto(){
  if(state.autoRefresh>0){ setAutoRefresh(0); $("#autoRefresh").value="0"; }
  else { setAutoRefresh(60); $("#autoRefresh").value="60"; }
  renderLiveBadge();
}
function renderLiveBadge(){
  $("#liveState").textContent = state.autoRefresh>0 ? `On (${state.autoRefresh}s)` : "Off";
}
async function manualRefresh(silent=false){
  const url = $("#apiUrl").value.trim();
  if(!url) { if(!silent) toast("Set LIVE_API_URL to refresh"); return; }
  try{
    if(!silent) toast("Refreshing‚Ä¶");
    const json = await fetchApi(url);
    const hist = normalizeHistory(json.history || json || []);
    state.history = hist;
    updateProbabilities();
    renderAll();
    if(!silent) toast("Refreshed ‚úì");
  }catch(e){ if(!silent) toast("Refresh failed"); }
}

/* ----------------------- Probability & Visuals ---------------------------- */
function updateProbabilities(){
  state.probs = new Array(10).fill(0);
  state.history.forEach(h=> state.probs[h.num]++);
  const total = state.history.length || 1;
  state.probs = state.probs.map(c=> c/total);
}
function renderBars(){
  const box = $("#probBars"); box.innerHTML="";
  const max = Math.max(...state.probs, 0.01);
  state.probs.forEach((p,i)=>{
    const h = (p/max)*100;
    const el = document.createElement("div");
    el.className="bar";
    el.innerHTML = `<div class="bar-fill" style="height:${h}%"></div><small>${i}</small>`;
    box.appendChild(el);
  });

  const sorted = state.probs.map((v,i)=>({i,v})).sort((a,b)=>b.v-a.v);
  $("#probTop").textContent = `${sorted[0].i} (${(sorted[0].v*100).toFixed(1)}%)`;
  const btm = sorted[sorted.length-1];
  $("#probBottom").textContent = `${btm.i} (${(btm.v*100).toFixed(1)}%)`;

  // Canvas chart
  const canvas = $("#probCanvas"), ctx = canvas.getContext("2d");
  const w = canvas.width = canvas.clientWidth; const h = canvas.height;
  ctx.clearRect(0,0,w,h);
  const pad = 16, bw = (w - pad*2)/10 - 6, base = h - 26;
  ctx.font = "12px ui-monospace, monospace";
  state.probs.forEach((p,i)=>{
    const x = pad + i*(bw+6);
    const bh = Math.max(4, p*h*0.9);
    const y = base - bh;
    // bar
    const grd = ctx.createLinearGradient(0,y,0,y+bh);
    grd.addColorStop(0,"#68b5ff");
    grd.addColorStop(1,"#3b82f6");
    ctx.fillStyle=grd; ctx.fillRect(x,y,bw,bh);
    // outline
    ctx.strokeStyle="#0f2233"; ctx.strokeRect(x,y,bw,bh);
    // label
    ctx.fillStyle="#9cb3cc"; ctx.fillText(String(i), x+bw/2-3, h-8);
  });
}

/* ----------------------------- Predictions -------------------------------- */
function decisionTag(conf){
  if(conf>=state.high) return `<span class="chip money">Money Magnet üß≤</span>`;
  if(conf>= (state.high - 0.07)) return `<span class="chip soft">Soft üíö</span>`;
  return `<span class="chip risk">Risky</span>`;
}
function renderPredictions(){
  const wrap = $("#predList"); wrap.innerHTML="";
  const show = state.history.slice(0,20);
  show.forEach(h=>{
    const row = document.createElement("div");
    row.className="pred-row";
    const time = new Date(h.ts).toLocaleTimeString();
    row.innerHTML = `
      <div class="tiny mono">üïí ${time}</div>
      <div class="mono">tail ${h.period} ‚Üí <b>#${h.num}</b> (${h.type}) ‚Ä¢ <span class="tiny">${h.color}</span></div>
      <div>${decisionTag(h.confidence)}</div>
    `;
    wrap.appendChild(row);
  });
}

/* ------------------------------- Patterns --------------------------------- */
function renderPatterns(){
  const hist = state.history.slice(0,40);
  const patBS = $("#patBS"); patBS.innerHTML="";
  const patCR = $("#patCR"); patCR.innerHTML="";
  hist.forEach(h=>{
    const pill1 = document.createElement("div");
    pill1.className="p-pill " + (h.type==="Big"?"p-bg":"p-sm");
    pill1.textContent = h.type;
    patBS.appendChild(pill1);

    const pill2 = document.createElement("div");
    pill2.className="p-pill " + (h.color==="Green"?"p-green":"p-red");
    pill2.textContent = h.color;
    patCR.appendChild(pill2);
  });

  // Hot/Cold
  const counts = Array(10).fill(0);
  hist.forEach(h=>counts[h.num]++);
  const arr = counts.map((c,i)=>({i,c})).sort((a,b)=>b.c-a.c);
  const hot = arr.slice(0,3), cold = arr.slice(-3).reverse();

  $("#hotList").innerHTML = hot.map(x=>`<div class="p-pill">${x.i} <span class="tiny">(${x.c})</span></div>`).join("");
  $("#coldList").innerHTML = cold.map(x=>`<div class="p-pill">${x.i} <span class="tiny">(${x.c})</span></div>`).join("");

  // Gap Heatmap = distance since last seen
  const lastSeen = new Map();
  const gaps = [];
  hist.forEach((h,idx)=>{
    const prev = lastSeen.get(h.num);
    const gap = (prev==null) ? "‚Äî" : (idx - prev);
    lastSeen.set(h.num, idx);
    gaps.push({num:h.num, gap});
  });
  const gm = $("#gapMap"); gm.innerHTML="";
  gaps.forEach(g=>{
    const el = document.createElement("div");
    el.className="p-pill";
    el.innerHTML = `#${g.num} <span class="tiny">gap:${g.gap}</span>`;
    gm.appendChild(el);
  });
}

/* -------------------------------- Stats ----------------------------------- */
function renderStats(){
  const hist = state.history;
  const total = hist.length;
  $("#st-total").textContent = String(total);

  const mm = hist.filter(h=>h.confidence>=state.high).length;
  const mmRate = total? (mm/total): 0;
  $("#st-mm").textContent = (mmRate*100).toFixed(1)+"%";
  $("#st-mm-p").style.width = (mmRate*100)+"%";

  const avg = total? (hist.reduce((a,b)=>a+b.confidence,0)/total):0;
  $("#st-avg").textContent = (avg*100).toFixed(1)+"%";
  $("#st-avg-p").style.width = ((avg-0.5)/0.45*100)+"%";

  const counts = Array(10).fill(0); hist.forEach(h=>counts[h.num]++);
  const top = counts.map((c,i)=>({i,c})).sort((a,b)=>b.c-a.c)[0] || {i:"‚Äî",c:0};
  $("#st-top").textContent = `${top.i} (${total? (top.c/total*100).toFixed(1):"0.0"}%)`;

  // Distribution canvas
  const canvas = $("#distCanvas"), ctx = canvas.getContext("2d");
  const w = canvas.width = canvas.clientWidth, h = canvas.height;
  ctx.clearRect(0,0,w,h);
  const pad=16, bw=(w-pad*2)/10 - 4, base=h-24;
  const max = Math.max(...counts,1);
  ctx.font="12px ui-monospace, monospace";
  counts.forEach((c,i)=>{
    const x=pad+i*(bw+4), bh = Math.max(4, c/max*(h*0.85));
    const y = base - bh;
    ctx.fillStyle = "#1f2a38"; ctx.fillRect(x,y,bw,bh);
    ctx.strokeStyle="#243241"; ctx.strokeRect(x,y,bw,bh);
    ctx.fillStyle="#9cb3cc"; ctx.fillText(String(i), x+bw/2-3, h-6);
  });
}

/* --------------------------- Check by Period ------------------------------ */
function checkByPeriod(input){
  // Allow plain period or strings; extract last 6‚Äì12 digits for stability
  const s = String(input).replace(/\D/g,"");
  const period = s.length>=4 ? s : ("0000"+s).slice(-6);
  const d = periodDigit(period);
  const type = d>=5 ? "Big":"Small";
  const color = digitColor(d, period);
  const conf = computeConfidence(d, period, state.history);
  return {input, period: Number(period), digit:d, type, color, conf};
}
function renderCheck(res){
  $("#res-input").textContent = res.input;
  $("#res-period").textContent = res.period;
  $("#res-digit").textContent = "#"+res.digit;
  $("#res-type").textContent = res.type;
  $("#res-color").textContent = res.color;
  $("#res-conf").textContent = (res.conf*100).toFixed(1)+"%";
  $("#res-decision").outerHTML = decisionTag(res.conf);
}

/* ------------------------------ Render All -------------------------------- */
function renderAll(){
  renderBars();
  renderPredictions();
  renderPatterns();
  renderStats();
}

/* --------------------------------- Init ----------------------------------- */
function init(){
  bindControls();
  renderAll();
  renderLiveBadge();
}
init();
</script>
</body>
</html>
