<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>🎯 WinGo Predictor Pro</title>
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#000000">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --gold:#ffd34d; --gold2:#f3c000;
  --ink:#eaf0ff; --muted:#91a2bf;
  --bg:#0a0d14; --card:#111826; --pill:#0f1726; --stroke:#212a3c;
  --ok:#22c55e; --am:#f59e0b; --bad:#ef4444;
  --radius:16px; --shadow:0 14px 32px rgba(0,0,0,.35);
}
*{box-sizing:border-box}
html,body{margin:0;background:radial-gradient(900px 520px at 12% -10%,#1a2233 0,#0b1019 55%,#05080e 100%) fixed;color:#fff;font:16px/1.45 ui-sans-serif,system-ui,Segoe UI,Roboto}

/* Header */
header{position:sticky;top:0;z-index:30;background:linear-gradient(180deg,#0b1019,#0b1019e0);backdrop-filter:blur(6px);border-bottom:1px solid #0f1726}
.head{max-width:1160px;margin:auto;padding:10px 16px;display:flex;justify-content:space-between;align-items:center}
.brand{
  display:inline-flex;align-items:center;gap:12px;padding:10px 18px;border-radius:999px;
  background:linear-gradient(180deg,var(--gold),var(--gold2));color:#12131a;font-weight:900;letter-spacing:.25px;
  box-shadow:0 8px 18px #000 inset,0 2px 10px rgba(0,0,0,.35)
}
.brand-dot{width:12px;height:12px;border-radius:999px;background:#0d1019;position:relative;box-shadow:0 0 0 6px #0003}
.brand-dot::after{
  content:"";position:absolute;inset:-4px; border-radius:999px; border:2px solid #0000; border-top-color:#0008; animation:spin 1.4s linear infinite
}
@keyframes spin{to{transform:rotate(360deg)}}
.switch{display:inline-flex;align-items:center;gap:8px;color:#cfe0ff;font-size:13px}
.switch input{accent-color:var(--gold)}

/* Layout */
.container{max-width:1160px;margin:18px auto;padding:0 16px 28px}
.section{background:var(--card);border:1px solid var(--stroke);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px;margin-bottom:14px}
.h1{font-size:18px;font-weight:900;margin:0 0 10px}
.sub{font-size:12px;color:var(--muted)}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:14px}
@media (max-width:920px){.grid-2{grid-template-columns:1fr}}

/* Inputs / Pills / Buttons */
label{font-size:13px;color:#cfe0ff;font-weight:800;display:block;margin:6px 0}
input,select{width:100%;padding:14px;background:#0e1421;border:2px solid #1e2638;border-radius:12px;color:#fff;outline:none}
input:focus,select:focus{border-color:var(--gold)}
.row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
.pill{display:inline-flex;align-items:center;gap:10px;padding:12px 14px;border-radius:16px;background:var(--pill);border:1px solid var(--stroke);color:#e7eeff;font-weight:800}
.pill>input[type="checkbox"], .pill>input[type="radio"]{accent-color:var(--gold)}
.pill select{width:120px;background:#0e1421;border:1px solid #273149}
.btn{border:0;border-radius:12px;padding:12px 18px;font-weight:900;cursor:pointer}
.btn.gold{background:linear-gradient(180deg,var(--gold),var(--gold2));color:#111}
.btn.ghost{background:#172033;border:1px solid #2a3550;color:#eaf0ff}
.badge{display:inline-flex;align-items:center;padding:7px 10px;border-radius:999px;border:1px solid #2a3550;background:#0f1624;color:#bfd0ff;font-size:12px}

/* Result */
.kv{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
@media (max-width:920px){.kv{grid-template-columns:1fr}}
.box{background:#0e1421;border:1px solid var(--stroke);border-radius:14px;padding:14px}
.key{font-size:12px;color:#9eb1d3}.val{font-size:34px;font-weight:900;color:var(--gold)}
.progress{height:10px;background:#1e2740;border-radius:999px;overflow:hidden}
.bar{height:10px;width:0;background:linear-gradient(90deg,var(--gold),#68e47a)}
.signal{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;font-weight:900;border:1px solid #2a3550}
.sig-ok{background:#0f1b13;color:var(--ok)} .sig-am{background:#1e1509;color:var(--am)} .sig-bad{background:#1a0e0e;color:var(--bad)}

.history{font-size:13px;color:#dce6ff;max-height:240px;overflow:auto}
.hrow{padding:8px 0;border-bottom:1px dashed #26324a}
.sep{height:1px;background:#162036;margin:12px 0}

/* Stats */
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
@media (max-width:920px){.stats{grid-template-columns:1fr 1fr}}
.stat{background:#0e1421;border:1px solid var(--stroke);border-radius:12px;padding:12px}
.stat .t{font-size:12px;color:#9eb1d3}.stat .n{font-weight:900;font-size:22px}
.compact .container{max-width:820px}
</style>
</head>
<body>
<header>
  <div class="head">
    <div class="brand"><span class="brand-dot"></span>WINGO PREDICTOR PRO</div>
    <label class="switch"><input id="compact" type="checkbox"> Compact</label>
  </div>
</header>

<div class="container">

  <!-- (1) TRADING CONTROLS -->
  <div class="section">
    <div class="h1">Quick Predict</div>
    <div class="grid-2">
      <div>
        <label>🧾 Period Number</label>
        <input id="period" placeholder="e.g. 20250813100052810"/>
        <div class="sub">केवल digits (0–9) • tail ऑटो दिखेगा</div>
      </div>
      <div>
        <label>Strategy</label>
        <select id="mode">
          <option value="balanced">Normal</option>
          <option value="conservative">Confident</option>
          <option value="aggressive">Very Confident</option>
        </select>
        <div class="row" style="margin-top:8px">
          <span class="pill"><input id="autoNext" type="checkbox"> Auto Next</span>
          <span class="pill">Interval
            <select id="interval"><option value="30">30 sec</option><option value="60">60 sec</option></select>
          </span>
          <span class="pill"><input id="antiSeq" type="checkbox" checked> Anti-sequence</span>
          <span class="pill"><input id="learnOn" type="checkbox" checked> Learning ON</span>
          <span class="pill"><input id="soundOn" type="checkbox" checked> Sound ON</span>
          <button class="btn ghost" id="notifyBtn">🔔 Notifications</button>
        </div>
      </div>
    </div>

    <div class="sep"></div>
    <div class="row">
      <button class="btn gold" id="btnPredict">🔮 Predict</button>
      <button class="btn ghost" id="btnClear">Clear</button>
      <button class="btn ghost" id="btnCopy">Copy Result</button>
      <button class="btn ghost" id="btnResetLearn">Reset Learning</button>
      <button class="btn ghost" id="btnExport">Export Settings</button>
      <button class="btn ghost" id="btnImport">Import Settings</button>
      <span class="badge" id="periodInfo">—</span>
    </div>
  </div>

  <!-- (2) PATTERN & RISK -->
  <div class="section">
    <div class="h1">Pattern Pack & Risk</div>
    <div class="row" style="gap:12px">
      <span class="pill"><input type="checkbox" id="patReverse" checked> Reverse</span>
      <span class="pill"><input type="checkbox" id="patMirror" checked> Mirror</span>
      <span class="pill"><input type="checkbox" id="patCont" checked> Continuous</span>
      <span class="pill"><input type="checkbox" id="patGap" checked> Gap/Skip</span>
      <span class="pill"><input type="checkbox" id="guard" checked> Streak-Guard</span>
    </div>
    <div class="row" style="margin-top:8px">
      <span class="pill">Confidence gate
        <select id="gate"><option value="med">Med</option><option value="high" selected>High</option><option value="very">Very</option></select>
      </span>
      <span class="pill">Soft gate
        <select id="softGate"><option value="lo">Lo</option><option value="med" selected>Med</option></select>
      </span>
      <span class="pill">Max Skip
        <select id="maxSkip"><option>2</option><option selected>3</option><option>4</option></select>
      </span>
    </div>
  </div>

  <!-- (3) VERIFY & LEARN -->
  <div class="section">
    <div class="h1">Verify & Learn</div>
    <div class="row">
      <span class="pill"><input type="radio" name="act" value="small"> Actual Small (0–4)</span>
      <span class="pill"><input type="radio" name="act" value="big"> Actual Big (5–9)</span>
      <button class="btn ghost" id="btnVerify">Verify & Learn</button>
      <span class="badge" id="verifyMsg">—</span>
    </div>
  </div>

  <!-- RESULT -->
  <div class="section" id="resultCard" style="display:none">
    <div class="kv">
      <div class="box"><div class="key">Period</div><div class="val" id="vPeriod">—</div></div>
      <div class="box"><div class="key">Predicted</div><div class="val" id="vNum">—</div></div>
      <div class="box"><div class="key">Size</div><div class="val" id="vSize">—</div></div>
    </div>
    <div style="margin-top:10px">
      <div class="key">Confidence</div>
      <div class="progress"><div class="bar" id="confBar"></div></div>
    </div>
    <div style="margin-top:10px">
      <span class="signal sig-bad" id="sig">Skip</span>
      <span class="badge" id="stake">Stake: —</span>
      <span class="badge" id="why">—</span>
    </div>
  </div>

  <!-- ANALYTICS -->
  <div class="grid-2">
    <div class="section">
      <div class="h1">📊 Probability (0–9)</div>
      <canvas id="probChart" height="220"></canvas>
    </div>
    <div class="section">
      <div class="h1">🕘 Recent Predictions</div>
      <div class="history" id="hist">—</div>
    </div>
  </div>

  <!-- STATS -->
  <div class="section">
    <div class="h1">📈 Session Stats</div>
    <div class="stats">
      <div class="stat"><div class="t">Plays</div><div class="n" id="stPlays">0</div></div>
      <div class="stat"><div class="t">Soft Plays</div><div class="n" id="stSoft">0</div></div>
      <div class="stat"><div class="t">Skips</div><div class="n" id="stSkips">0</div></div>
      <div class="stat"><div class="t">Avg Conf.</div><div class="n" id="stConf">0%</div></div>
      <div class="stat"><div class="t">Win-rate (verified)</div><div class="n" id="stWin">—</div></div>
    </div>
  </div>
</div>

<script>
/* ---------- SW & Notifications ---------- */
(async()=>{ if('serviceWorker' in navigator){ try{ await navigator.serviceWorker.register('/sw.js'); }catch{} }})();
async function ensureNotify(){ if(!('Notification' in window)) return false; if(Notification.permission==='granted') return true; if(Notification.permission==='denied') return false; return (await Notification.requestPermission())==='granted'; }

/* ---------- Coin sound ---------- */
function coinChime(){ if(!document.getElementById('soundOn').checked) return;
  try{ const A=new (window.AudioContext||window.webkitAudioContext)(); const o=A.createOscillator(), g=A.createGain();
    o.connect(g); g.connect(A.destination); o.type='triangle';
    o.frequency.setValueAtTime(880,A.currentTime); g.gain.setValueAtTime(0.0001,A.currentTime);
    g.gain.exponentialRampToValueAtTime(0.5,A.currentTime+0.01);
    o.frequency.exponentialRampToValueAtTime(1660,A.currentTime+0.12);
    g.gain.exponentialRampToValueAtTime(0.0001,A.currentTime+0.8);
    o.start(); o.stop(A.currentTime+1);
  }catch{} }

/* ---------- Helpers ---------- */
const el=id=>document.getElementById(id), isDigits=s=>/^\d+$/.test(s||"");
const normalize=a=>{const s=a.reduce((p,c)=>p+c,0)||1;return a.map(x=>x/s);};
const argmax=a=>a.indexOf(Math.max(...a)), clamp01=x=>Math.max(0,Math.min(1,x));
const bump=p=>{try{return (BigInt(p)+1n).toString()}catch{const a=p.split('').map(n=>+n);for(let i=a.length-1;i>=0;i--){if(a[i]===9)a[i]=0;else{a[i]++;break;}}return a.join('')}};
function hash32(str){let h=2166136261>>>0;for(let i=0;i<str.length;i++){h^=str.charCodeAt(i);h=Math.imul(h,16777619)}return h>>>0;}
function mulberry32(s){return function(){let t=s+=0x6D2B79F5;t=Math.imul(t^t>>>15,t|1);t^=t+Math.imul(t^t>>>7,t|61);return((t^t>>>14)>>>0)/4294967296}}
function tailInfo(p){return isDigits(p)?`len ${p.length} • tail ${p.slice(-4)}`:'—';}

/* ---------- Local memory ---------- */
const LS_SIZE='WPP_SIZE2', LS_REC='WPP_RECENT', LS_CFG='WPP_CFG';
const loadSize=()=>{try{return JSON.parse(localStorage.getItem(LS_SIZE))||[1,1]}catch{return[1,1]}};
const saveSize=s=>localStorage.setItem(LS_SIZE,JSON.stringify(s));
function pushRec(o){try{const r=JSON.parse(localStorage.getItem(LS_REC))||[];r.unshift(o);if(r.length>80)r.length=80;localStorage.setItem(LS_REC,JSON.stringify(r));}catch{}}

/* ---------- Priors & Patterns ---------- */
function priorChecksum(period){
  if(!isDigits(period)) return Array(10).fill(0.1);
  const s=[...period].reduce((a,b)=>a+(+b),0), t=(s%9+s%10)%10, v=Array(10).fill(0.1);
  v[t]+=0.30; v[(t+1)%10]+=0.16; v[(t+9)%10]+=0.16; return normalize(v);
}
function priorCyclic(period){
  if(!isDigits(period)) return Array(10).fill(0.1);
  const d=[...period].map(Number), sum=d.reduce((a,b)=>a+b,0), v=Array(10).fill(0.1);
  v[sum%10]+=0.22; v[(sum%7*3)%10]+=0.18; v[(sum%7*5)%10]+=0.16; return normalize(v);
}
function priorDistanceHashed(period){
  if(!isDigits(period)) return Array(10).fill(0.1);
  const seedDigit=hash32(period+'K')%10, v=Array(10).fill(0.1);
  for(let i=0;i<10;i++){const d=Math.min((i-seedDigit+10)%10,(seedDigit-i+10)%10); v[i]+=0.26*Math.exp(-0.55*d);}
  return normalize(v);
}
function parity(period){ if(!isDigits(period)) return 0.5; return ((+period.slice(-2))%2===0)?0.62:0.38; }
function applyPatterns(period, base){
  let p=base.slice(), why=[];
  const t=period.slice(-4), rev=t.split('').reverse().join(''), mir=([...t].map(x=>(9-+x)).join(''));
  if(el('patReverse').checked){ p[(+rev)%10]+=0.08; why.push('rev'); }
  if(el('patMirror').checked){ p[(+mir)%10]+=0.08; why.push('mir'); }
  if(el('patCont').checked){ const m=(+period.slice(-1)+1)%10; p[m]+=0.06; why.push('cont'); }
  if(el('patGap').checked){ const g=(+period.slice(-3))%5; for(let i=g;i<10;i+=5)p[i]+=0.04; why.push('gap'); }
  return {p:normalize(p), why};
}

/* ---------- Predictor ---------- */
function predictLocal(period, mode){
  const H={
    conservative:{temp:1.04,cap:0.58,jitter:0.05,adapt:0.12,w:[0.28,0.26,0.22,0.24]},
    balanced    :{temp:1.06,cap:0.62,jitter:0.08,adapt:0.18,w:[0.26,0.26,0.24,0.24]},
    aggressive  :{temp:1.08,cap:0.66,jitter:0.12,adapt:0.24,w:[0.24,0.26,0.26,0.24]}
  }[mode];

  const P1=priorChecksum(period), P2=priorCyclic(period), P3=priorDistanceHashed(period), P4=Array(10).fill(0.1);
  for(let i=0;i<10;i+=2) P4[i]+=0.12*parity(period); for(let i=1;i<10;i+=2) P4[i]+=0.12*(1-parity(period));

  let base=normalize(P1.map((_,i)=>H.w[0]*P1[i]+H.w[1]*P2[i]+H.w[2]*P3[i]+H.w[3]*P4[i]));
  const pat=applyPatterns(period,base); base=pat.p;

  if(el('learnOn').checked){
    const s=loadSize(), total=s[0]+s[1], sb=s[0]/total, bb=s[1]/total, k=0.30;
    for(let i=0;i<5;i++)  base[i]*=(1-k+k*sb);
    for(let i=5;i<10;i++) base[i]*=(1-k+k*bb);
    base=normalize(base);
  }

  // bootstrap
  const rnd=mulberry32(hash32(period)), B=72, j=H.jitter, agg=Array(10).fill(0), votes=Array(10).fill(0);
  for(let b=0;b<B;b++){ const p=normalize(base.map(x=>Math.max(0,x*(1+(rnd()*2-1)*j)))); p.forEach((x,i)=>agg[i]+=x); votes[argmax(p)]++; }
  let probs=normalize(agg).map(p=>Math.pow(p,1/H.temp)); probs=normalize(probs);

  // cap
  const iM=argmax(probs), mx=probs[iM];
  if(mx>H.cap){ const excess=mx-H.cap; probs[iM]-=excess; const rest=probs.reduce((a,b,i)=>i===iM?a:a+b,0)||1; const scale=(1-probs[iM])/rest; for(let i=0;i<10;i++) if(i!==iM) probs[i]*=scale; probs=normalize(probs); }

  const stability=Math.max(...votes)/B;
  return {probs,stability,why:pat.why.join(',')||'mix'};
}

/* ---------- Gates + Fallback ---------- */
let skipStreak=0, stat={plays:0,soft:0,skips:0,sumConf:0,nConf:0,winN:0,winD:0};
function decideSignal(conf, ent, probs){
  const gate=el('gate').value, soft=el('softGate').value, maxSkip=parseInt(el('maxSkip').value||'3',10);
  const hard = gate==='very'?0.78: gate==='high'?0.66:0.58;
  const softT= soft==='med'?0.48:0.42;

  if(conf>=hard){ skipStreak=0; stat.plays++; return {sig:'Play',cls:'sig-ok',stake:'Full',why:`conf ${Math.round(conf*100)}% ≥ gate`, mode:'digit'}; }

  // Size-only fallback if entropy high but size-bias strong
  const sizeProb = probs.slice(5).reduce((a,b)=>a+b,0); // P(Big)
  if(skipStreak>=maxSkip && sizeProb>=0.62){
    skipStreak=0; stat.soft++; return {sig:'Soft Play',cls:'sig-am',stake:'Half',why:`fallback size Big ${Math.round(sizeProb*100)}%`, mode:'size-big'};
  }
  if(skipStreak>=maxSkip && sizeProb<=0.38){
    skipStreak=0; stat.soft++; return {sig:'Soft Play',cls:'sig-am',stake:'Half',why:`fallback size Small ${Math.round((1-sizeProb)*100)}%`, mode:'size-small'};
  }

  if(skipStreak>=maxSkip && ent>=softT){
    skipStreak=0; stat.soft++; return {sig:'Soft Play',cls:'sig-am',stake:'Half',why:`maxSkip ${maxSkip} • soft`, mode:'digit'};
  }

  skipStreak++; stat.skips++; return {sig:'Skip',cls:'sig-bad',stake:'No bet',why:`conf ${Math.round(conf*100)}%`, mode:'skip'};
}
function kellyStake(p){ // even odds
  const b=1, q=1-p, f=(b*p-q)/b; return Math.max(0,Math.min(1,f)); }

/* ---------- Chart ---------- */
let probChart=null;
function drawChart(probs){
  const data=probs.map(p=>Math.round(p*1000)/10), labels=[...Array(10).keys()].map(String);
  if(probChart) probChart.destroy();
  probChart=new Chart(el('probChart').getContext('2d'),{
    type:'bar', data:{labels,datasets:[{label:'Probability (%)',data}]},
    options:{responsive:true,scales:{y:{beginAtZero:true,title:{display:true,text:'%'}},x:{title:{display:true,text:'Digit'}}}}
  });
}

/* ---------- Render ---------- */
function render(period, out, source='manual'){
  drawChart(out.probs);
  const pick=argmax(out.probs), size=pick>=5?'Big':'Small';
  let H=0; out.probs.forEach(p=>{ if(p>0) H+=-p*Math.log(p) }); const entropy=clamp01(1-H/Math.log(10));
  const stability=clamp01(out.stability||0); const conf=clamp01(0.55*entropy+0.45*stability);
  stat.sumConf+=conf; stat.nConf++;

  const decision=decideSignal(conf, entropy, out.probs);

  el('resultCard').style.display='block';
  el('vPeriod').textContent=period; el('vNum').textContent=pick; el('vSize').textContent=size;
  el('confBar').style.width=(conf*100).toFixed(1)+'%';

  const sig=el('sig'); sig.textContent=decision.sig; sig.className='signal '+decision.cls;

  // stake suggestion
  let stakePct='—';
  if(decision.sig!=='Skip'){
    const pEst = conf; // proxy
    stakePct = Math.round(kellyStake(pEst)*100)+'%';
  }
  el('stake').textContent='Stake: '+stakePct;
  el('why').textContent='Why: '+decision.why + ' • patterns ['+out.why+']';

  const h=el('hist'); if(h.textContent==='—') h.textContent='';
  const tag = decision.mode.startsWith('size') ? `• ${decision.mode.replace('size-','')}` : '';
  h.insertAdjacentHTML('afterbegin',`<div class="hrow">⏱ ${new Date().toLocaleTimeString()} • tail ${String(period).slice(-4)} → #${pick} (${size}) • <span style="opacity:.85">${decision.sig}${tag}</span></div>`);
  [...h.children].slice(80).forEach(n=>n.remove());

  if(source==='auto' && decision.sig!=='Skip'){
    ensureNotify().then(ok=>{
      if(ok && navigator.serviceWorker?.ready){
        navigator.serviceWorker.ready.then(reg=>{
          reg.showNotification(`${decision.sig} • tail ${String(period).slice(-3)}`,{
            body:`#${pick} • ${size} • ${Math.round(conf*100)}% • Stake ${stakePct}`,
            tag:`wingo-${period}`, renotify:true, badge:'/icons/icon-192.png', icon:'/icons/icon-192.png'
          });
        });
      }
    });
    coinChime();
  }

  pushRec({time:Date.now(),pick,size,conf,sig:decision.sig});
  updateStatsUI();
}

/* ---------- Stats UI ---------- */
function updateStatsUI(){
  el('stPlays').textContent=stat.plays;
  el('stSoft').textContent=stat.soft;
  el('stSkips').textContent=stat.skips;
  el('stConf').textContent= stat.nConf? Math.round((stat.sumConf/stat.nConf)*100)+'%' : '0%';
  el('stWin').textContent= stat.winD? Math.round((stat.winN/stat.winD)*100)+'%' : '—';
}

/* ---------- Auto & Actions ---------- */
let timer=null, busy=false;
function runPredict(source='manual'){
  if(busy) return; busy=true; setTimeout(()=>busy=false,120);
  const p=el('period').value.trim(); if(!isDigits(p)){ alert('Valid period number भरें'); return; }
  el('periodInfo').textContent=tailInfo(p);
  const out=predictLocal(p, el('mode').value);
  render(p,out,source);
}
function startAuto(){
  const sec=parseInt(el('interval').value||'30',10);
  clearInterval(timer);
  timer=setInterval(()=>{ const cur=el('period').value.trim(); if(isDigits(cur)) el('period').value=bump(cur); runPredict('auto'); },sec*1000);
}

/* ---------- Settings Export/Import ---------- */
function readCfg(){
  return {
    mode:el('mode').value, interval:el('interval').value, anti:el('antiSeq').checked,
    learn:el('learnOn').checked, sound:el('soundOn').checked,
    pats:{rev:el('patReverse').checked, mir:el('patMirror').checked, cont:el('patCont').checked, gap:el('patGap').checked},
    guard:el('guard').checked, gate:el('gate').value, soft:el('softGate').value, maxSkip:el('maxSkip').value
  };
}
function applyCfg(c){
  try{
    el('mode').value=c.mode; el('interval').value=c.interval; el('antiSeq').checked=c.anti;
    el('learnOn').checked=c.learn; el('soundOn').checked=c.sound;
    el('patReverse').checked=c.pats.rev; el('patMirror').checked=c.pats.mir; el('patCont').checked=c.pats.cont; el('patGap').checked=c.pats.gap;
    el('guard').checked=c.guard; el('gate').value=c.gate; el('softGate').value=c.soft; el('maxSkip').value=c.maxSkip;
  }catch{}
}
function saveCfg(){ localStorage.setItem(LS_CFG, JSON.stringify(readCfg())); }
function loadCfg(){ try{ const c=JSON.parse(localStorage.getItem(LS_CFG)); if(c) applyCfg(c); }catch{} }

/* ---------- Bindings ---------- */
document.addEventListener('DOMContentLoaded', ()=>{
  loadCfg(); updateStatsUI();
  el('compact').onchange=e=>{ document.body.classList.toggle('compact', e.target.checked); };

  el('btnPredict').onclick=()=>{ saveCfg(); runPredict('manual'); };
  el('period').addEventListener('keydown',e=>{ if(e.key==='Enter') { saveCfg(); runPredict('manual'); } });
  el('btnClear').onclick=()=>{ clearInterval(timer); timer=null; el('autoNext').checked=false; el('period').value=''; el('periodInfo').textContent='—'; el('resultCard').style.display='none'; el('hist').textContent='—'; if(probChart){probChart.destroy();probChart=null} skipStreak=0; stat={plays:0,soft:0,skips:0,sumConf:0,nConf:0,winN:0,winD:0}; updateStatsUI(); };
  el('btnCopy').onclick=async()=>{ const txt=`Period: ${el('vPeriod').textContent}, Number: ${el('vNum').textContent}, Size: ${el('vSize').textContent}`; try{ await navigator.clipboard.writeText(txt); alert('Copied'); }catch{} };
  el('autoNext').onchange=e=>{ clearInterval(timer); timer=null; if(e.target.checked) startAuto(); };
  el('interval').onchange=()=>{ if(el('autoNext').checked) startAuto(); saveCfg(); };
  el('notifyBtn').onclick=async()=> alert((await ensureNotify())?'Notifications ON':'Notifications blocked');

  el('btnVerify').onclick=()=>{
    const chosen=document.querySelector('input[name="act"]:checked');
    const pick=el('vNum').textContent.trim();
    if(!pick||pick==='—'){ el('verifyMsg').textContent='पहले Predict करें'; return; }
    if(!chosen){ el('verifyMsg').textContent='Actual size चुनें'; return; }
    const actual=chosen.value, pred=(+pick>=5)?'big':'small', win=(actual===pred);
    el('verifyMsg').textContent= win? 'WIN ✔' : 'LOSS ✘';
    el('verifyMsg').style.color= win? 'var(--ok)' : 'var(--bad)';
    stat.winD++; if(win) stat.winN++; updateStatsUI();
    if(el('learnOn').checked){ const s=loadSize(); (actual==='big')?s[1]++:s[0]++; saveSize(s); }
  };

  el('btnResetLearn').onclick=()=>{ saveSize([1,1]); alert('Learning reset'); };
  el('btnExport').onclick=async()=>{ const data=JSON.stringify(readCfg()); try{ await navigator.clipboard.writeText(data); alert('Settings copied'); }catch{ alert(data); } };
  el('btnImport').onclick=()=>{ const j=prompt('Paste settings JSON'); if(!j) return; try{ const c=JSON.parse(j); applyCfg(c); saveCfg(); alert('Imported'); }catch{ alert('Invalid JSON'); } };
});
</script>
</body>
</html>
