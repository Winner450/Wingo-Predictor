<!DOCTYPE html><html lang="hi" class="theme-dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WinGo Predictor Pro ‚Äî Advanced Dashboard</title>
  <meta name="description" content="Single‚Äëfile professional dashboard for WinGo / Bingo style prediction with local AI heuristics + optional API adapter." />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    /* ===============================
       THEME SYSTEM (4 professional themes)
       Use: add .theme-dark / .theme-light / .theme-graphite / .theme-neon on <html>
       =============================== */
    :root {
      --radius: 16px;
      --shadow-1: 0 6px 20px rgba(0,0,0,.25);
      --shadow-2: 0 2px 8px rgba(0,0,0,.15);
      --ring: 0 0 0 3px rgba(99, 102, 241, .35);
      --gap: 16px;
      --trans: 180ms cubic-bezier(.2,.8,.2,1);
    }
    html { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji"; }/* DARK */
.theme-dark { --bg: #0c0e13; --panel:#12151d; --elev:#171b25; --muted:#8b93a7; --text:#e9ecf4; --brand:#8b5cf6; --accent:#22d3ee; --ok:#22c55e; --warn:#f59e0b; --bad:#ef4444; --grid:#232836; --chip:#1f2432; }
/* LIGHT */
.theme-light{ --bg:#f6f7fb; --panel:#ffffff; --elev:#f1f3f8; --muted:#6b7280; --text:#0c1222; --brand:#6d28d9; --accent:#0ea5e9; --ok:#16a34a; --warn:#d97706; --bad:#dc2626; --grid:#e5e7eb; --chip:#eef2ff; }
/* GRAPHITE */
.theme-graphite{ --bg:#0b0b0c; --panel:#121212; --elev:#1a1a1a; --muted:#9aa0a6; --text:#fafafa; --brand:#10b981; --accent:#60a5fa; --ok:#10b981; --warn:#f59e0b; --bad:#f43f5e; --grid:#222; --chip:#171717; }
/* NEON */
.theme-neon{ --bg:#060812; --panel:#0b0f1e; --elev:#0e1428; --muted:#8ca0cb; --text:#e6eeff; --brand:#7c3aed; --accent:#06b6d4; --ok:#22c55e; --warn:#fbbf24; --bad:#ef4444; --grid:#1a2342; --chip:#0f1630; }

body { background: var(--bg); color: var(--text); margin:0; }
a { color: var(--accent); text-decoration: none; }

/* Layout */
.layout { display: grid; grid-template-columns: 260px 1fr; min-height: 100vh; }
.sidebar { background: linear-gradient(180deg, var(--panel), var(--elev)); border-right: 1px solid var(--grid); padding: 20px; position: sticky; top:0; height: 100vh; overflow-y: auto; }
.brand { display:flex; align-items:center; gap: 10px; }
.brand .logo { width:36px;height:36px;border-radius:10px;background: linear-gradient(135deg,var(--brand),var(--accent)); box-shadow: var(--shadow-1);}
.brand h1 { font-size: 18px; margin:0; line-height:1.1; }
.tag { font-size: 11px; padding:3px 8px; background: var(--chip); border: 1px solid var(--grid); border-radius: 999px; color: var(--muted); }
.nav { margin-top: 22px; display:flex; flex-direction: column; gap:6px; }
.nav a { padding:10px 12px; border-radius: 10px; color: var(--muted); display:flex; align-items:center; gap:10px; transition: background var(--trans), color var(--trans); }
.nav a.active, .nav a:hover { background: var(--chip); color: var(--text); }
.spacer { height: 14px; }
.badge { background: var(--brand); color: #fff; border-radius: 999px; padding: 2px 8px; font-size: 11px; }

main { padding: 24px; }
.toolbar { display:flex; justify-content: space-between; align-items:center; gap: 12px; margin-bottom: 18px; }
.toolbar .left { display:flex; align-items:center; gap: 10px; }
.toolbar h2 { margin:0; font-size: 22px; }
.toolbar .actions { display:flex; align-items:center; gap: 10px; }
.btn { padding: 10px 14px; border-radius: 12px; border: 1px solid var(--grid); background: var(--panel); color: var(--text); cursor: pointer; transition: transform var(--trans), background var(--trans), border-color var(--trans); }
.btn:hover { transform: translateY(-1px); background: var(--elev); }
.btn.primary { background: linear-gradient(135deg,var(--brand),var(--accent)); border: none; color:#fff; }
.btn.ghost { background: transparent; }

.grid { display:grid; gap: var(--gap); }
.grid.kpis { grid-template-columns: repeat(4, minmax(0,1fr)); }
.grid.two { grid-template-columns: 1.2fr .8fr; }
.grid.three { grid-template-columns: 1fr 1fr 1fr; }

@media (max-width: 1100px){
  .layout { grid-template-columns: 1fr; }
  .sidebar { position: relative; height: auto; }
  .grid.kpis { grid-template-columns: repeat(2, 1fr); }
  .grid.two { grid-template-columns: 1fr; }
  .grid.three { grid-template-columns: 1fr; }
}

.card { background: linear-gradient(180deg, var(--panel), var(--elev)); border: 1px solid var(--grid); box-shadow: var(--shadow-2); border-radius: var(--radius); padding: 16px; }
.card h3 { margin: 0 0 10px 0; font-size: 16px; font-weight: 700; }
.card .muted { color: var(--muted); font-size: 12px; }

.kpi { display:flex; align-items: center; justify-content: space-between; }
.kpi .value { font-size: 26px; font-weight: 800; }
.chip { display:inline-flex; align-items:center; gap:6px; padding: 6px 10px; border-radius: 999px; border: 1px solid var(--grid); background: var(--chip); font-size: 12px; }
.ok{ color: var(--ok);} .warn{color: var(--warn);} .bad{color: var(--bad);} .brand{ color: var(--brand);}

.form { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.form .field { display:flex; flex-direction: column; gap:8px; }
.field label { font-size: 12px; color: var(--muted); }
.field input, .field select, .field textarea { padding: 12px 12px; background: var(--panel); color: var(--text); border-radius: 12px; border: 1px solid var(--grid); outline: none; transition: border var(--trans), box-shadow var(--trans), background var(--trans); }
.field input:focus, .field select:focus, .field textarea:focus { border-color: var(--brand); box-shadow: var(--ring); }
.field textarea { min-height: 108px; resize: vertical; }
.row { display:flex; gap: 12px; align-items:center; }
.row .btn{ flex: 1; }

.list { display:flex; flex-direction: column; gap: 10px; max-height: 360px; overflow:auto; }
.log-item{ display:flex; justify-content:space-between; border:1px dashed var(--grid); padding:10px; border-radius:12px; }

.slider{ -webkit-appearance:none; appearance:none; width:100%; height:6px; background: var(--grid); border-radius:999px; outline:none; }
.slider::-webkit-slider-thumb{ -webkit-appearance:none; appearance:none; width:18px; height:18px; background: linear-gradient(135deg,var(--brand),var(--accent)); border-radius:50%; box-shadow: var(--shadow-1);} 

.footer-note{ margin-top: 16px; font-size: 12px; color: var(--muted); }
.pill { padding: 4px 10px; border-radius: 999px; border:1px solid var(--grid);}

.divider{ height:1px;background:var(--grid); margin: 10px 0 16px 0; }

.color-legend{ display:flex; gap:8px; flex-wrap:wrap; }
.legend-dot{ width:10px; height:10px; border-radius:50%; display:inline-block; }

  </style>
</head>
<body>
  <div class="layout">
    <!-- SIDEBAR -->
    <aside class="sidebar">
      <div class="brand">
        <div class="logo"></div>
        <div>
          <h1>WinGo Predictor <span class="badge">Pro</span></h1>
          <div class="tag">Backend-ready ‚Ä¢ Local AI Heuristics</div>
        </div>
      </div><nav class="nav">
    <a href="#dashboard" class="active">üè† ‡§°‡•à‡§∂‡§¨‡•ã‡§∞‡•ç‡§°</a>
    <a href="#predict">üéØ ‡§™‡•ç‡§∞‡•á‡§°‡§ø‡§ï‡•ç‡§∂‡§®</a>
    <a href="#charts">üìä ‡§ö‡§æ‡§∞‡•ç‡§ü‡•ç‡§∏</a>
    <a href="#settings">‚öôÔ∏è ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏</a>
    <a href="#logs">üßæ ‡§≤‡•â‡§ó‡•ç‡§∏</a>
  </nav>

  <div class="spacer"></div>
  <div class="card">
    <h3>‡§•‡•Ä‡§Æ ‡§¨‡§¶‡§≤‡•á‡§Ç</h3>
    <div class="row">
      <button class="btn" data-theme="theme-dark">Dark</button>
      <button class="btn" data-theme="theme-light">Light</button>
    </div>
    <div class="row" style="margin-top:8px;">
      <button class="btn" data-theme="theme-graphite">Graphite</button>
      <button class="btn" data-theme="theme-neon">Neon</button>
    </div>
  </div>

  <div class="spacer"></div>
  <div class="card">
    <h3>‡§∞‡§Ç‡§ó ‡§®‡§ø‡§Ø‡§Æ (‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó)</h3>
    <div class="muted">‡§Ü‡§™ ‡§ö‡§æ‡§π‡•á‡§Ç ‡§§‡•ã ‡§¨‡§¶‡§≤ ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç</div>
    <div class="divider"></div>
    <div class="color-legend" id="colorLegend"></div>
  </div>

  <div class="spacer"></div>
  <div class="card">
    <h3>Import/Export</h3>
    <div class="row">
      <button class="btn" id="btnExport">Export JSON</button>
      <input type="file" id="fileImport" class="btn" style="padding:8px;" />
    </div>
  </div>

  <div class="spacer"></div>
  <div class="footer-note">Disclaimer: ‡§Ø‡§π ‡§ï‡•á‡§µ‡§≤ ‡§∏‡§æ‡§Ç‡§ñ‡•ç‡§Ø‡§ø‡§ï‡•Ä‡§Ø ‡§Ö‡§®‡•Å‡§Æ‡§æ‡§® ‡§π‡•à; ‡§ú‡•Ä‡§§ ‡§ï‡•Ä ‡§ï‡•ã‡§à ‡§ó‡§æ‡§∞‡§Ç‡§ü‡•Ä ‡§®‡§π‡•Ä‡§Ç‡•§ ‡§ñ‡•á‡§≤‡§®‡•á ‡§∏‡•á ‡§™‡§π‡§≤‡•á ‡§ú‡•ã‡§ñ‡§ø‡§Æ ‡§∏‡§Æ‡§ù‡•á‡§Ç‡•§</div>
</aside>

<!-- MAIN -->
<main>
  <div class="toolbar">
    <div class="left">
      <h2>Advanced Prediction Dashboard</h2>
      <span class="pill">v2.0 ‚Äì Single File</span>
    </div>
    <div class="actions">
      <button class="btn ghost" id="btnClear">Clear</button>
      <button class="btn primary" id="btnPredictTop">Get Prediction</button>
    </div>
  </div>

  <!-- KPIs -->
  <section id="dashboard" class="grid kpis">
    <div class="card kpi">
      <div>
        <div class="muted">Top Pick</div>
        <div class="value" id="kpiTop">‚Äî</div>
      </div>
      <div class="chip" id="kpiColor">Color: ‚Äî</div>
    </div>
    <div class="card kpi">
      <div>
        <div class="muted">Confidence</div>
        <div class="value" id="kpiConf">‚Äî</div>
      </div>
      <div class="chip" id="kpiSize">Size: ‚Äî</div>
    </div>
    <div class="card kpi">
      <div>
        <div class="muted">Last Number</div>
        <div class="value" id="kpiLast">‚Äî</div>
      </div>
      <div class="chip">Trend: <span id="kpiTrend">‚Äî</span></div>
    </div>
    <div class="card kpi">
      <div>
        <div class="muted">Backtest (Walk‚ÄëFwd)</div>
        <div class="value" id="kpiBT">‚Äî</div>
      </div>
      <button class="btn" id="btnBacktest">Run</button>
    </div>
  </section>

  <div class="spacer"></div>

  <!-- PREDICTION FORM + STRATEGY -->
  <section id="predict" class="grid two">
    <div class="card">
      <h3>Prediction</h3>
      <div class="muted">‡§Ø‡§¶‡§ø API ‡§∏‡•á‡§ü ‡§π‡•à ‡§§‡•ã ‡§â‡§∏‡•Ä ‡§ï‡•ã ‡§™‡•ç‡§∞‡§æ‡§•‡§Æ‡§ø‡§ï‡§§‡§æ; ‡§µ‡§∞‡•ç‡§®‡§æ ‡§≤‡•ã‡§ï‡§≤ AI ‡§ï‡§æ‡§Æ ‡§ï‡§∞‡•á‡§ó‡§æ‡•§</div>
      <div class="divider"></div>
      <div class="form">
        <div class="field">
          <label>API Base URL (optional)</label>
          <input id="apiBase" placeholder="https://your-api.example.com" />
        </div>
        <div class="field">
          <label>Product</label>
          <select id="product">
            <option value="wingo_blue">wingo_blue</option>
            <option value="wingo_green">wingo_green</option>
            <option value="wingo_red">wingo_red</option>
          </select>
        </div>
        <div class="field">
          <label>Period Number</label>
          <input id="period" placeholder="e.g. 52312" />
        </div>
        <div class="field">
          <label>‡§™‡§ø‡§õ‡§≤‡•á ‡§®‡§Ç‡§¨‡§∞ (comma/space)</label>
          <textarea id="history" placeholder="7 6 3 3 6"></textarea>
        </div>
        <div class="row">
          <button class="btn primary" id="btnPredict">Predict</button>
          <button class="btn" id="btnSave">Save Settings</button>
        </div>
      </div>

      <div class="divider"></div>
      <div class="row">
        <div class="chip">Top candidates: <span id="topCandidates">‚Äî</span></div>
        <div class="chip">Last seen: <span id="lastSeen">‚Äî</span></div>
      </div>
    </div>

    <div class="card">
      <h3>Strategy Weights</h3>
      <div class="muted">‡§π‡§∞ ‡§´‡•Ä‡§ö‡§∞ ‡§ï‡•á ‡§µ‡•á‡§ü ‡§∏‡•á ensemble score ‡§¨‡§®‡§§‡§æ ‡§π‡•à‡•§</div>
      <div class="divider"></div>
      <div class="field">
        <label>Frequency Weight <span id="wFreqLbl" class="badge">0.6</span></label>
        <input class="slider" type="range" id="wFreq" min="0" max="1" step="0.05" value="0.6" />
      </div>
      <div class="field">
        <label>Markov / Transition Weight <span id="wMarkovLbl" class="badge">0.3</span></label>
        <input class="slider" type="range" id="wMarkov" min="0" max="1" step="0.05" value="0.3" />
      </div>
      <div class="field">
        <label>Recency Bias Weight <span id="wRecencyLbl" class="badge">0.1</span></label>
        <input class="slider" type="range" id="wRecency" min="0" max="1" step="0.05" value="0.1" />
      </div>
      <div class="row">
        <div class="chip">Œ£ Weights: <span id="sumW">1.0</span></div>
        <button class="btn" id="btnResetW">Reset</button>
      </div>
    </div>
  </section>

  <div class="spacer"></div>

  <!-- CHARTS -->
  <section id="charts" class="grid two">
    <div class="card">
      <h3>Frequency Chart</h3>
      <canvas id="freqChart" height="140"></canvas>
    </div>
    <div class="card">
      <h3>Transition Heatmap</h3>
      <canvas id="heatChart" height="140"></canvas>
    </div>
  </section>

  <div class="spacer"></div>

  <!-- LOGS & EVENTS -->
  <section id="logs" class="grid two">
    <div class="card">
      <h3>Event Log</h3>
      <div class="list" id="logList"></div>
    </div>
    <div class="card">
      <h3>How it works</h3>
      <ul>
        <li>‡§π‡§ø‡§∏‡•ç‡§ü‡•ç‡§∞‡•Ä ‡§∏‡§æ‡§´ ‡§ï‡§∞ ‡§ï‡•á ‡§™‡§ø‡§õ‡§≤‡•á ‡§∞‡§æ‡§â‡§Ç‡§°‡•ç‡§∏ (0‚Äë9) ‡§¶‡•á‡§Ç‡•§</li>
        <li>‡§è‡§®‡•ç‡§∏‡•á‡§Æ‡•ç‡§¨‡§≤ = Frequency + Markov + Recency (normalized)‡•§</li>
        <li>Big/Small: 0‚Äë4 Small, 5‚Äë9 Big.</li>
        <li>Color mapping ‡§®‡•Ä‡§ö‡•á ‡§ï‡•â‡§®‡•ç‡§´‡§º‡§ø‡§ó ‡§Æ‡•á‡§Ç ‡§è‡§°‡§ø‡§ü‡•á‡§¨‡§≤ ‡§π‡•à‡•§</li>
        <li>API ‡§π‡•à ‡§§‡•ã <code>GET {base}/predict?product=..&period=..&history=0,3,7...</code> ‡§ü‡•ç‡§∞‡§æ‡§Ø ‡§ï‡§∞‡§§‡§æ ‡§π‡•à‡•§</li>
      </ul>
    </div>
  </section>

</main>

  </div>  <!-- Charts CDN (Chart.js) -->  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>  <script>
    // =============================
    // Utilities
    // =============================
    const $ = (sel) => document.querySelector(sel);
    const logList = $('#logList');
    function log(msg){
      const el = document.createElement('div');
      el.className = 'log-item';
      const ts = new Date().toLocaleTimeString();
      el.innerHTML = `<span class="muted">${ts}</span><span>${msg}</span>`;
      logList.prepend(el);
    }

    function parseHistory(str){
      return (str||'')
        .replace(/\n/g,' ')
        .split(/[ ,]+/)
        .map(s=>s.trim())
        .filter(Boolean)
        .map(n=>Number(n)%10)
        .filter(n=>!Number.isNaN(n));
    }

    // Save / Load settings
    const store = {
      save(){ const data = {
        apiBase: $('#apiBase').value, product: $('#product').value,
        period: $('#period').value, history: $('#history').value,
        w: { f: +$('#wFreq').value, m: +$('#wMarkov').value, r: +$('#wRecency').value },
        theme: document.documentElement.classList.value
      }; localStorage.setItem('wingo_pro', JSON.stringify(data)); log('Settings saved.'); },
      load(){ const s = localStorage.getItem('wingo_pro'); if(!s) return; try{ const data = JSON.parse(s);
        $('#apiBase').value = data.apiBase||''; $('#product').value = data.product||'wingo_blue';
        $('#period').value = data.period||''; $('#history').value = data.history||'';
        if(data.w){ $('#wFreq').value = data.w.f; $('#wMarkov').value = data.w.m; $('#wRecency').value = data.w.r; syncWeights(); }
        if(data.theme){ document.documentElement.className = data.theme; }
        refreshLegend();
      }catch(e){} }
    };

    // Color mapping (editable)
    const colorMap = {
      GREEN: [1,3,7,9],
      RED: [2,4,6,8],
      VIOLET: [0,5]
    };

    function numToColor(n){
      for(const [k,arr] of Object.entries(colorMap)) if(arr.includes(n)) return k; return '‚Äî';
    }

    function refreshLegend(){
      const container = document.getElementById('colorLegend');
      container.innerHTML = '';
      Object.entries(colorMap).forEach(([name, arr])=>{
        const row = document.createElement('div');
        row.className = 'chip';
        row.innerHTML = `<b>${name}</b>: ${arr.join(', ')}`;
        container.appendChild(row);
      });
    }

    // =============================
    // Ensemble Prediction Engine
    // =============================
    function frequencyScores(hist){
      const f = Array(10).fill(0);
      hist.forEach(n=>f[n]++);
      const total = Math.max(1, hist.length);
      return f.map(v=>v/total);
    }

    function recencyScores(hist){
      const s = Array(10).fill(0);
      const L = hist.length;
      for(let i=0;i<L;i++){
        const n = hist[i];
        const w = (i+1)/L; // newer -> higher weight
        s[n] += w;
      }
      const sum = s.reduce((a,b)=>a+b,0) || 1;
      return s.map(v=>v/sum);
    }

    function markovScores(hist){
      // 10x10 transition counts
      const T = Array.from({length:10},()=>Array(10).fill(0));
      for(let i=0;i<hist.length-1;i++){
        const a = hist[i];
        const b = hist[i+1];
        T[a][b]++;
      }
      // last value
      const last = hist[hist.length-1];
      if(last==null) return Array(10).fill(0.1); // flat
      const row = T[last];
      const sum = row.reduce((a,b)=>a+b,0) || 1;
      return row.map(v=>v/sum);
    }

    function normalize(arr){
      const min = Math.min(...arr), max = Math.max(...arr);
      if(max-min === 0) return arr.map(_=>1/arr.length);
      const z = arr.map(v=>(v-min)/(max-min)+1e-9);
      const sum = z.reduce((a,b)=>a+b,0);
      return z.map(v=>v/sum);
    }

    function ensemblePredict(hist, weights){
      const f = frequencyScores(hist);
      const m = markovScores(hist);
      const r = recencyScores(hist);
      const sumW = weights.f + weights.m + weights.r;
      const wF = weights.f/sumW, wM = weights.m/sumW, wR = weights.r/sumW;
      const score = f.map((_,i)=> wF*f[i] + wM*m[i] + wR*r[i]);
      const probs = normalize(score);
      // top 3
      const idx = [...Array(10).keys()].sort((a,b)=>probs[b]-probs[a]);
      return { probs, top: idx.slice(0,3), last: hist[hist.length-1] }
    }

    function bigSmall(n){ return (n<=4) ? 'SMALL' : 'BIG'; }

    // =============================
    // Charts
    // =============================
    let freqChart, heatChart;
    function drawFreq(hist){
      const f = Array(10).fill(0); hist.forEach(n=>f[n]++);
      const ctx = document.getElementById('freqChart');
      if(freqChart) freqChart.destroy();
      freqChart = new Chart(ctx, {
        type:'bar', data:{ labels:[0,1,2,3,4,5,6,7,8,9], datasets:[{ label:'Frequency', data:f }] },
        options:{ responsive:true, scales:{ y:{ beginAtZero:true } } }
      });
    }

    function drawHeat(hist){
      const T = Array.from({length:10},()=>Array(10).fill(0));
      for(let i=0;i<hist.length-1;i++){ T[hist[i]][hist[i+1]]++; }
      const flat = T.flat();
      const max = Math.max(1, ...flat);
      const data = { labels:[0,1,2,3,4,5,6,7,8,9], datasets: Array.from({length:10}, (_,r)=>({ label:`From ${r}`, data:T[r].map(v=>v/max) })) };
      const ctx = document.getElementById('heatChart');
      if(heatChart) heatChart.destroy();
      heatChart = new Chart(ctx, { type:'radar', data, options:{ plugins:{ legend:{ display:false } } } });
    }

    // =============================
    // Backtesting (walk-forward, top1 hit rate)
    // =============================
    function backtest(hist, weights){
      if(hist.length < 6) return 0;
      let hits=0, total=0;
      for(let i=4;i<hist.length-1;i++){
        const window = hist.slice(0,i);
        const {top} = ensemblePredict(window, weights);
        const next = hist[i];
        total++;
        if(top[0] === next) hits++;
      }
      return Math.round((hits/Math.max(1,total))*100);
    }

    // =============================
    // API Adapter (optional)
    // =============================
    async function tryApi(base, product, period, history){
      try{
        const url = `${base.replace(/\/$/,'')}/predict?product=${encodeURIComponent(product)}&period=${encodeURIComponent(period)}&history=${encodeURIComponent(history.join(','))}`;
        const r = await fetch(url, { method:'GET' });
        if(!r.ok) throw new Error('HTTP '+r.status);
        const data = await r.json();
        return data; // expected { number, probs:[...], meta:{...} }
      }catch(e){ log('API fallback ‚Üí local model ('+e.message+')'); return null; }
    }

    // =============================
    // UI Wiring
    // =============================
    function syncWeights(){
      const f = +$('#wFreq').value, m = +$('#wMarkov').value, r = +$('#wRecency').value;
      $('#wFreqLbl').textContent = f.toFixed(2);
      $('#wMarkovLbl').textContent = m.toFixed(2);
      $('#wRecencyLbl').textContent = r.toFixed(2);
      $('#sumW').textContent = (f+m+r).toFixed(2);
    }

    document.getElementById('btnResetW').onclick = ()=>{ $('#wFreq').value=0.6; $('#wMarkov').value=0.3; $('#wRecency').value=0.1; syncWeights(); };
    ['wFreq','wMarkov','wRecency'].forEach(id=> $('#'+id).addEventListener('input', syncWeights));

    document.getElementById('btnSave').onclick = ()=> store.save();
    document.getElementById('btnClear').onclick = ()=>{ $('#history').value=''; log('History cleared.'); drawFreq([]); drawHeat([]); };

    // Theme buttons
    document.querySelectorAll('[data-theme]').forEach(btn=>{
      btn.addEventListener('click', ()=>{ document.documentElement.className = btn.dataset.theme; store.save(); });
    });

    async function doPredict(){
      const base = $('#apiBase').value.trim();
      const product = $('#product').value;
      const period = $('#period').value.trim();
      const hist = parseHistory($('#history').value);
      if(hist.length===0){ log('‡§ï‡•É‡§™‡§Ø‡§æ ‡§ï‡•Å‡§õ ‡§á‡§§‡§ø‡§π‡§æ‡§∏ ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç.'); return; }

      drawFreq(hist); drawHeat(hist);
      const weights = { f:+$('#wFreq').value, m:+$('#wMarkov').value, r:+$('#wRecency').value };

      // Try API first
      let apiResp = null;
      if(base){ apiResp = await tryApi(base, product, period, hist); }

      let result;
      if(apiResp && Array.isArray(apiResp.probs)){
        const idx = [...Array(10).keys()].sort((a,b)=>apiResp.probs[b]-apiResp.probs[a]).slice(0,3);
        result = { probs: apiResp.probs, top: idx, last: hist[hist.length-1] };
      } else {
        result = ensemblePredict(hist, weights);
      }

      // Update KPIs
      const top = result.top[0];
      const conf = Math.round(result.probs[top]*100);
      $('#kpiTop').textContent = String(top);
      $('#kpiConf').textContent = conf + '%';
      $('#kpiLast').textContent = String(result.last ?? '‚Äî');
      $('#kpiColor').textContent = 'Color: ' + numToColor(top);
      $('#kpiSize').textContent = 'Size: ' + bigSmall(top);

      $('#lastSeen').textContent = String(result.last ?? '‚Äî');
      $('#topCandidates').textContent = `${result.top[0]} (${conf}%), ${result.top[1]} (${Math.round(result.probs[result.top[1]]*100)}%), ${result.top[2]} (${Math.round(result.probs[result.top[2]]*100)}%)`;

      log(`Predicted ${top} ‚Ä¢ ${bigSmall(top)} ‚Ä¢ ${numToColor(top)} @ ${conf}%`);
    }

    document.getElementById('btnPredict').onclick = doPredict;
    document.getElementById('btnPredictTop').onclick = doPredict;

    document.getElementById('btnBacktest').onclick = ()=>{
      const hist = parseHistory($('#history').value);
      const weights = { f:+$('#wFreq').value, m:+$('#wMarkov').value, r:+$('#wRecency').value };
      const acc = backtest(hist, weights);
      $('#kpiBT').textContent = acc + '%';
      log('Backtest top‚Äë1 hit rate: ' + acc + '%');
    };

    // Export / Import
    document.getElementById('btnExport').onclick = ()=>{
      const payload = {
        settings: JSON.parse(localStorage.getItem('wingo_pro')||'{}'),
        history: $('#history').value,
        ts: Date.now()
      };
      const blob = new Blob([JSON.stringify(payload,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = 'wingo_pro_export.json'; a.click();
      URL.revokeObjectURL(url);
    };

    document.getElementById('fileImport').addEventListener('change', async (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const text = await file.text();
      try{ const j = JSON.parse(text);
        if(j.settings){ localStorage.setItem('wingo_pro', JSON.stringify(j.settings)); }
        if(j.history){ $('#history').value = j.history; }
        store.load(); log('Import successful.');
      }catch(err){ log('Import failed: ' + err.message); }
    });

    // Initial
    refreshLegend();
    store.load();
    syncWeights();
    log('Ready. Enter history and click Predict.');
  </script></body>
</html>
