<!doctype html>

<html lang="hi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WhatsApp Sender — Click / Cloud API</title>
  <style>
    :root{--card:#fff;--muted:#6b7280;--accent:#0ea5e9}
    body{font-family:system-ui,Segoe UI,Roboto,Arial,sans-serif;background:#f8fafc;padding:28px}
    .wrap{max-width:880px;margin:0 auto}
    header{display:flex;gap:12px;align-items:center;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .card{background:var(--card);border-radius:14px;padding:18px;box-shadow:0 6px 24px rgba(2,6,23,0.06);border:1px solid #eef2f7}
    label{display:block;font-weight:600;margin:12px 0 6px}
    input[type=text],input[type=tel],textarea,select{width:100%;padding:12px;border:1px solid #e6edf3;border-radius:10px;font-size:15px}
    textarea{min-height:120px;resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .actions{display:flex;gap:8px;margin-top:12px}
    button{background:var(--accent);color:#fff;border:none;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:700}
    button.ghost{background:#fff;color:var(--accent);border:1px solid #dbeafe}
    small{color:var(--muted)}
    .muted{color:var(--muted);font-size:13px;margin-top:8px}
    .progress{margin-top:12px;background:#eef2f6;border-radius:8px;height:14px;overflow:hidden}
    .bar{height:100%;background:linear-gradient(90deg,#34d399,#0ea5e9);width:0%}
    pre{background:#0f1724;color:#e6eef8;padding:10px;border-radius:8px;overflow:auto}
    .flex{display:flex;gap:8px;align-items:center}
    .note{background:#fffbeb;border:1px solid #fef3c7;padding:10px;border-radius:8px;color:#854d0e}
    .small-btn{padding:8px 10px;border-radius:8px;font-weight:600}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>WhatsApp Sender — Click (Phone) & Cloud API (Automation)</h1>
    </header><div class="card">
  <label>Mode</label>
  <select id="mode">
    <option value="click">Click-to-WhatsApp (No backend)</option>
    <option value="api">WhatsApp Cloud API (Requires backend)</option>
  </select>

  <div style="margin-top:12px;" id="api-settings" hidden>
    <label>Backend Endpoint (POST)</label>
    <input id="apiEndpoint" placeholder="e.g. https://yourdomain.com/api/send" />
    <small class="muted">Backend should accept JSON: { to: "91XXXXXXXXXX", body: "message text" }</small>
  </div>

  <label>Recipient Numbers</label>
  <textarea id="numbers" placeholder="एक लाइन पर एक नंबर — country code सहित (e.g. 919812345678)\nया comma-separated लिखें"></textarea>
  <div class="flex" style="margin-top:8px">
    <input id="csvFile" type="file" accept=".csv" />
    <button class="ghost small-btn" id="loadCsv">Load CSV</button>
    <div style="flex:1"></div>
    <button class="ghost small-btn" id="clearList">Clear</button>
  </div>

  <label>Message (use {{name}} for personalization)</label>
  <textarea id="message" placeholder="नमस्ते {{name}}, हमारे पास खास ऑफर है...">नमस्ते! यह एक टेस्ट संदेश है।</textarea>

  <div class="row" style="margin-top:12px">
    <div>
      <label>Delay between messages (ms)</label>
      <input id="delay" type="text" value="500" />
    </div>
    <div>
      <label>Fallback: Open click link if API fails?</label>
      <select id="fallback"><option value="yes">Yes</option><option value="no">No</option></select>
    </div>
  </div>

  <div class="actions">
    <button id="sendBtn">Send Messages</button>
    <button id="previewBtn" class="ghost">Preview First</button>
  </div>

  <div class="muted">Progress: <span id="stats">0/0</span></div>
  <div class="progress"><div class="bar" id="bar"></div></div>
  <div style="margin-top:12px">
    <pre id="log">Ready.

</pre>
      </div><div class="note" style="margin-top:12px">
    नोट: Cloud API use करने के लिए Meta का WhatsApp Business Cloud API setup, PHONE_NUMBER_ID और ACCESS_TOKEN आपके backend में जरूरी होंगे। 24-hour window, templates और opt-in नियमों का पालन करें।
  </div>
</div>

<p style="margin-top:12px;color:var(--muted)">अगर आप backend भी चाहते हैं तो बोलिए — मैं Express (Node) / Flask (Python) दोनों में ready code बना दूँगा।</p>

  </div>  <script>
    // Helpers
    const $ = id => document.getElementById(id);
    const mode = $('mode');
    const apiSettings = $('api-settings');
    mode.addEventListener('change', e => {
      apiSettings.hidden = e.target.value === 'click';
    });

    // CSV load
    $('loadCsv').addEventListener('click', () => {
      const f = $('csvFile').files[0];
      if(!f){ alert('Please choose a CSV file (one number per line or comma separated).'); return; }
      const reader = new FileReader();
      reader.onload = ev => {
        const txt = ev.target.result;
        // accept both commas and newlines
        const numbers = txt.split(/[,\n\r]+/).map(s=>s.trim()).filter(Boolean);
        $('numbers').value = numbers.join('\n');
      };
      reader.readAsText(f);
    });

    $('clearList').addEventListener('click', ()=>{$('numbers').value='';});

    function parseNumbers(){
      const raw = $('numbers').value.trim();
      if(!raw) return [];
      const arr = raw.split(/[,\n\r]+/).map(s=>s.trim()).filter(Boolean);
      return arr;
    }

    function sleep(ms){return new Promise(r=>setTimeout(r,ms));}

    async function sendSingleAPI(endpoint, to, body){
      try{
        const res = await fetch(endpoint,{
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ to, body })
        });
        const data = await res.json();
        return { ok: res.ok, status: res.status, data };
      }catch(e){
        return { ok:false, error: e.message };
      }
    }

    function openClickLink(to, body){
      const url = `https://wa.me/${encodeURIComponent(to)}?text=${encodeURIComponent(body)}`;
      window.open(url, '_blank');
    }

    $('previewBtn').addEventListener('click', ()=>{
      const nums = parseNumbers();
      if(!nums.length){ alert('Please add at least one number'); return; }
      const first = nums[0];
      const msg = $('message').value.replace('{{name}}', first);
      if(mode.value === 'click'){
        openClickLink(first, msg);
      }else{
        alert('Preview will attempt to call your API endpoint. Make sure it is set and CORS allows this origin.');
        console.log('Preview sending to API...');
      }
    });

    $('sendBtn').addEventListener('click', async ()=>{
      const nums = parseNumbers();
      if(!nums.length){ alert('Please add recipient numbers'); return; }
      const delay = parseInt($('delay').value || '500', 10);
      const endpoint = $('apiEndpoint').value.trim();
      const total = nums.length;
      $('stats').textContent = `0/${total}`;
      $('bar').style.width = '0%';
      $('log').textContent = 'Starting...\n';

      let sent = 0;
      for(let i=0;i<nums.length;i++){
        const to = nums[i];
        const personalized = $('message').value.replace(/{{name}}/g, to);
        if(mode.value === 'click'){
          openClickLink(to, personalized);
          sent++;
        }else{
          if(!endpoint){
            $('log').textContent += 'API mode selected but backend endpoint not set. Aborting.\n';
            break;
          }
          const res = await sendSingleAPI(endpoint, to, personalized);
          if(res.ok){
            sent++;
            $('log').textContent += `${to}: OK (status ${res.status})\n`;
          }else{
            $('log').textContent += `${to}: ERROR ${res.error || JSON.stringify(res.data)}\n`;
            if($('fallback').value === 'yes'){
              openClickLink(to, personalized);
              $('log').textContent += `--> Fallback opened click link for ${to}\n`;
              sent++;
            }
          }
        }
        $('stats').textContent = `${sent}/${total}`;
        const pct = Math.round((i+1)/total*100);
        $('bar').style.width = pct + '%';
        await sleep(delay);
      }

      $('log').textContent += 'Finished.\n';
    });
  </script></body>
</html>
