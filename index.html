<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>🎯 WinGo Predictor Pro (Period Only)</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{ --gold:#FFD700; --gold-soft:#f5d46b; --bg1:#0f0f0f; --bg2:#000;
           --card:#111; --muted:#9ca3af; --danger:#f87171; --ok:#22c55e; --warn:#f59e0b; }
    *{ box-sizing:border-box }
    body{ margin:0; font-family:'Segoe UI',system-ui,sans-serif;
          background:linear-gradient(to bottom right,var(--bg1),var(--bg2)); color:#fff; text-align:center; }
    header{ background:#000; padding:16px 0; box-shadow:0 2px 8px var(--gold) }
    header h1{ margin:0; font-size:28px; color:var(--gold) }
    .container{ padding:26px 16px; max-width:1180px; margin:0 auto }
    .row{ display:grid; grid-template-columns:1fr 1fr; gap:16px }
    @media (max-width:950px){ .row{ grid-template-columns:1fr } }
    .card{ background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:18px; padding:18px; text-align:left;
           box-shadow:0 0 15px rgba(0,0,0,.35) }
    label{ font-weight:600 }
    input, select{ margin-top:8px; width:100%; padding:12px; border-radius:10px;
           border:2px solid var(--gold); background:#000; color:#fff; text-align:center; font-size:16px; }
    .btn{ margin-top:12px; background:var(--gold); color:#000; border:0; border-radius:10px;
          padding:12px 18px; font-weight:700; cursor:pointer; box-shadow:0 0 12px var(--gold) }
    .btn.secondary{ background:#1f2937; color:#fff; box-shadow:none; border:1px solid #333 }
    .meta{ font-size:13px; color:#9ca3af; margin-top:6px }
    .result-box{ background:#0b0b0b; border:1px solid #1f2937; border-radius:14px; padding:16px; display:none }
    .line{ height:8px; background:#222; border-radius:6px; overflow:hidden; margin-top:8px }
    .bar{ height:8px; background:linear-gradient(90deg,var(--gold-soft),var(--gold)); width:0% }
    .kv{ display:flex; justify-content:space-between; gap:12px; flex-wrap:wrap }
    .kv div{ flex:1; min-width:140px }
    .val{ font-weight:800; color:var(--gold) }
    .tag{ display:inline-block; padding:4px 8px; border:1px solid #333; border-radius:999px; font-size:12px; color:#ddd; margin-right:6px }
    .pill{display:inline-block;padding:4px 8px;border-radius:999px;border:1px solid #333;margin-right:6px}
    .ok{color:var(--ok)} .danger{color:var(--danger)} .warn{color:var(--warn)}
    .history{ font-size:12px; color:#cbd5e1; max-height:184px; overflow:auto }
    .rowflex{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
  </style>
</head>
<body>
  <header><h1>🎯 WinGo Predictor Pro</h1></header>

  <div class="container">

    <div class="card">
      <div class="rowflex">
        <div style="flex:2">
          <label for="period">🧾 <b>Period Number (required)</b></label>
          <input id="period" placeholder="e.g. 20250813100052810" />
          <div class="meta">bdgop WinGo_30S जैसा लंबा period ID—केवल digits (0–9)</div>
        </div>
        <div style="flex:1">
          <label for="mode"><b>Strategy</b></label>
          <select id="mode">
            <option value="balanced" selected>Balanced</option>
            <option value="conservative">Conservative</option>
            <option value="aggressive">Aggressive</option>
          </select>
          <label class="meta" style="display:block;margin-top:8px"><input type="checkbox" id="autoNext"> Auto Next (30s)</label>
          <input id="autoEvery" type="number" min="5" value="30" style="width:100px"/>
          <span class="meta">sec</span>
        </div>
      </div>

      <div class="rowflex" style="margin-top:10px">
        <button class="btn" id="btnPredict">🔮 Predict</button>
        <button class="btn secondary" id="btnClear">Clear</button>
        <button class="btn secondary" id="btnCopy">Copy Result</button>
        <span class="tag" id="apiStatus">API: local</span>
      </div>

      <div class="meta" id="periodInfo">—</div>
    </div>

    <div class="card">
      <div id="resultBox" class="result-box">
        <div class="kv">
          <div>🧾 Period<br><span class="val" id="vPeriod">–</span></div>
          <div>🔢 Number<br><span class="val" id="vNum">–</span></div>
          <div>📏 Size<br><span class="val" id="vSize">–</span></div>
          <div>🎯 Opposite backup<br><span class="val" id="vBackup">–</span></div>
        </div>

        <div style="margin-top:10px">🧠 Confidence</div>
        <div class="line"><div class="bar" id="confBar"></div></div>
        <div class="kv" style="margin-top:10px">
          <div>🟩 Big<br><span class="val" id="vBig">–</span></div>
          <div>🟥 Small<br><span class="val" id="vSmall">–</span></div>
          <div>🔒 Stability<br><span class="val" id="vStab">–</span></div>
        </div>

        <div style="margin-top:12px">
          <span id="playSignal" class="pill">—</span>
          <span id="top2" class="pill">Safe set: —</span>
          <span id="top3" class="pill">Top-3: —</span>
          <span id="reasons" class="pill">—</span>
        </div>
      </div>
    </div>

    <div class="row" style="margin-top:16px">
      <div class="card">
        <h3 style="margin:0 0 8px">📊 Probability (0–9)</h3>
        <canvas id="probChart" height="210"></canvas>
      </div>
      <div class="card">
        <h3 style="margin:0 0 8px">⚖️ Big vs Small</h3>
        <canvas id="bsChart" height="210"></canvas>
      </div>
    </div>

    <div class="row" style="margin-top:16px">
      <div class="card">
        <h3 style="margin:0 0 8px">🕘 Recent Predictions (by period)</h3>
        <div id="hist" class="history">—</div>
      </div>
    </div>
  </div>

  <script>
    // ===== helpers =====
    let probChart=null, bsChart=null, autoTimer=null;
    const el=id=>document.getElementById(id);
    const clamp01=x=>Math.max(0,Math.min(1,x));
    const fmtPct=x=>(x*100).toFixed(1)+'%';
    const sum=a=>a.reduce((p,c)=>p+c,0);
    const normalize=a=>{const s=sum(a)||1; return a.map(x=>x/s);};
    const argmax=a=>{let i=0,b=-1; for(let k=0;k<a.length;k++){ if(a[k]>b){b=a[k]; i=k;} } return i; };
    const isDigits=s=>/^\d+$/.test(s||"");

    // ===== Period-derived weak prior =====
    function periodPrior(periodStr){
      if(!isDigits(periodStr)) return Array(10).fill(0.1);
      const d = periodStr.split('').map(n=>+n);
      const s  = d.reduce((a,b)=>a+b,0);
      const last = d[d.length-1];
      const last2 = +(periodStr.slice(-2));
      const mod10 = s % 10;
      const mod7  = s % 7;
      const freq = Array(10).fill(0); d.forEach(x=>freq[x]++);
      const v = Array(10).fill(0.1);

      // core signals
      v[mod10] += 0.7;                 // digit-sum thumbprint
      v[(last+10)%10] += 0.35;         // last digit anchor
      v[(last+1)%10]  += 0.18;
      v[(last+9)%10]  += 0.18;
      v[(mod7*3)%10]  += 0.25;         // mod7 mapping spread
      v[(mod7*5)%10]  += 0.20;
      // even/odd from last2
      if(last2%2===0){ for(let i=0;i<10;i+=2) v[i]+=0.08; }
      else{ for(let i=1;i<10;i+=2) v[i]+=0.08; }
      // digit frequency inside period itself (tiny)
      for(let i=0;i<10;i++) v[i] += 0.02*freq[i];

      return normalize(v);
    }

    // ===== Period-only model with bootstrap =====
    function predictFromPeriod(periodStr, mode='balanced'){
      const hyper = {
        conservative:{ temp:1.04, maxCap:0.58, jitter:0.05 },
        balanced    :{ temp:1.06, maxCap:0.62, jitter:0.08 },
        aggressive  :{ temp:1.08, maxCap:0.66, jitter:0.12 }
      }[mode] || { temp:1.06, maxCap:0.62, jitter:0.08 };

      // base prior
      const base = periodPrior(periodStr);

      // Monte-Carlo bootstrap (jittered priors)
      const B=60, j=hyper.jitter;
      let agg=Array(10).fill(0), votes=Array(10).fill(0);
      for(let b=0;b<B;b++){
        const p = normalize(base.map(x => Math.max(0, x*(1 + (Math.random()*2-1)*j))));
        for(let i=0;i<10;i++) agg[i]+=p[i];
        votes[argmax(p)]++;
      }
      let probs = normalize(agg);

      // temperature + maxCap
      probs = normalize(probs.map(p=>Math.pow(p, 1/hyper.temp)));
      const mx = Math.max(...probs);
      if(mx>hyper.maxCap){
        const iM = argmax(probs), excess = mx-hyper.maxCap; probs[iM]-=excess;
        const baseSum = probs.reduce((a,b,i)=>i===iM?a:a+b,0)||1;
        const scale = (1-probs[iM])/baseSum;
        for(let i=0;i<10;i++) if(i!==iM) probs[i]*=scale;
        probs = normalize(probs);
      }

      const stability = Math.max(...votes)/B;
      return { probs, stability };
    }

    // ===== Charts & UI =====
    function renderCharts(probs){
      const big = probs.slice(5).reduce((a,b)=>a+b,0), small = 1-big;
      const labels=[...Array(10).keys()].map(String);
      const data=probs.map(p=>Math.round(p*1000)/10);
      if(probChart) probChart.destroy();
      probChart=new Chart(el('probChart').getContext('2d'),{
        type:'bar',
        data:{labels, datasets:[{label:'Probability (%)', data}]},
        options:{responsive:true, scales:{ y:{beginAtZero:true,title:{display:true,text:'%'}}, x:{title:{display:true,text:'Digit'}}}}
      });
      if(bsChart) bsChart.destroy();
      bsChart=new Chart(el('bsChart').getContext('2d'),{
        type:'doughnut',
        data:{labels:['Big','Small'], datasets:[{data:[Math.round(big*100),Math.round(small*100)]}]},
        options:{responsive:true, cutout:'60%'}
      });
      return { big, small };
    }

    function renderResult(out, periodStr){
      const probs = out.probs;
      const predicted = argmax(probs);
      const { big, small } = renderCharts(probs);

      // entropy → confidence
      let H=0; probs.forEach(p=>{ if(p>0) H += -p*Math.log(p); });
      const confidence = Math.max(0, Math.min(1, 1 - H/Math.log(10)));
      const opp = (predicted>=5)? argmax(probs.slice(0,5)) : 5 + argmax(probs.slice(5));

      el('resultBox').style.display='block';
      el('vPeriod').textContent = periodStr;
      el('vNum').textContent = predicted;
      el('vSize').textContent = (predicted>=5?'Big':'Small');
      el('vBackup').textContent = opp;
      el('confBar').style.width = (confidence*100).toFixed(1)+'%';
      el('vBig').textContent = fmtPct(big);
      el('vSmall').textContent = fmtPct(small);
      el('vStab').textContent = fmtPct(out.stability ?? 0.3);

      // signal
      let signal='—', cls='';
      const reasons=[];
      if(confidence<0.18) reasons.push('low entropy');
      if((out.stability??0)<0.28) reasons.push('unstable');
      if(reasons.length>=2){ signal='Wait'; cls='danger'; }
      else if(reasons.length===1){ signal='Caution'; cls='warn'; }
      else { signal='Play'; cls='ok'; }

      const sorted=probs.map((p,i)=>({i,p})).sort((a,b)=>b.p-a.p);
      el('top2').textContent='Safe set: '+sorted.slice(0,2).map(o=>o.i).join(', ');
      el('top3').textContent='Top-3: '+sorted.slice(0,3).map(o=>`${o.i} (${(o.p*100).toFixed(1)}%)`).join(', ');
      el('playSignal').textContent=signal; el('playSignal').className='pill '+cls;
      el('reasons').textContent = reasons.length ? ('Reasons: '+reasons.join(', ')) : 'Reasons: good signal';

      // history feed
      const stamp=new Date().toLocaleTimeString();
      const line=`⏱ ${stamp} • Period ${periodStr} → #${predicted} (${predicted>=5?'Big':'Small'}) • conf ${(confidence*100).toFixed(0)}% • stab ${((out.stability??0)*100).toFixed(0)}% • backup ${opp} • ${signal}`;
      const h=el('hist'); h.innerHTML=(h.innerHTML==='—'?'':h.innerHTML)+`<div>${line}</div>`;
    }

    // ===== Period tools =====
    const usedPeriods = new Set();
    const isDigits = s => /^\d+$/.test(s||"");
    function describePeriod(p){ if(!isDigits(p)) return '—'; return `len ${p.length} • tail ${p.slice(-4)}`; }
    function bumpPeriod(p){
      if(!isDigits(p)) return p;
      try{ return (BigInt(p)+1n).toString(); }catch{
        let a=p.split('').map(d=>+d), i=a.length-1;
        while(i>=0){ if(a[i]===9){a[i]=0;i--;} else {a[i]++;break;} }
        return a.join('');
      }
    }

    async function runPredict(){
      const period = el('period').value.trim();
      if(!period || !isDigits(period)){ alert('Valid period number भरें (केवल digits)'); return; }
      el('periodInfo').textContent = 'Period: '+describePeriod(period);

      // duplicate warning
      if(usedPeriods.has(period)){
        if(!confirm('यह period पहले प्रेडिक्ट हो चुका है. फिर से चलाएँ?')) return;
      }
      usedPeriods.add(period);

      // local period-only prediction
      const out = predictFromPeriod(period, el('mode').value);
      renderResult(out, period);
    }

    // Auto Next (period +1 हर X sec)
    function startAuto(){
      clearInterval(autoTimer); autoTimer=null;
      const sec = Math.max(5, parseInt(el('autoEvery').value||'30',10));
      autoTimer = setInterval(()=>{
        const cur = el('period').value.trim();
        if(isDigits(cur)) el('period').value = bumpPeriod(cur);
        runPredict();
      }, sec*1000);
    }

    // events
    el('btnPredict').addEventListener('click', runPredict);
    el('btnClear').addEventListener('click', ()=>{
      el('period').value=''; el('resultBox').style.display='none';
      el('hist').textContent='—'; el('periodInfo').textContent='—';
    });
    el('btnCopy').addEventListener('click', async ()=>{
      const n=el('vNum').textContent; if(!n||n==='–'){ alert('पहले Predict करें'); return; }
      const text=`Period: ${el('vPeriod').textContent}, Number: ${el('vNum').textContent}, Size: ${el('vSize').textContent}, Big:${el('vBig').textContent}, Small:${el('vSmall').textContent}, Stability:${el('vStab').textContent}`;
      try{ await navigator.clipboard.writeText(text); alert('Copied!'); }catch{ alert('Copy failed'); }
    });
    el('autoNext').addEventListener('change', e=>{
      clearInterval(autoTimer); autoTimer=null;
      if(e.target.checked) startAuto();
    });
  </script>
</body>
</html>
